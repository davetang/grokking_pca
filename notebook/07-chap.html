<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.8.26">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Chapter 7: Multivariate Analysis – Grokking PCA</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<script src="../site_libs/quarto-html/quarto.js" type="module"></script>
<script src="../site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="../site_libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-587c61ba64f3a5504c4d52d930310e48.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap-4704fbbab809f1cd5b609e2913d9b4cf.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN" && texText && texText.data) {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body class="nav-fixed quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">Grokking PCA</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../index.html"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link active" href="../notebook/07-chap.html" aria-current="page"> 
<span class="menu-text">Chapter 7</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#setup" id="toc-setup" class="nav-link active" data-scroll-target="#setup">Setup</a></li>
  <li><a href="#learning-outcomes" id="toc-learning-outcomes" class="nav-link" data-scroll-target="#learning-outcomes">Learning outcomes</a></li>
  <li><a href="#example-data" id="toc-example-data" class="nav-link" data-scroll-target="#example-data">Example data</a></li>
  <li><a href="#low-dimensional-data-summaries" id="toc-low-dimensional-data-summaries" class="nav-link" data-scroll-target="#low-dimensional-data-summaries">Low-dimensional data summaries</a></li>
  <li><a href="#preprocessing-the-data" id="toc-preprocessing-the-data" class="nav-link" data-scroll-target="#preprocessing-the-data">Preprocessing the data</a></li>
  <li><a href="#dimension-reduction" id="toc-dimension-reduction" class="nav-link" data-scroll-target="#dimension-reduction">Dimension reduction</a>
  <ul class="collapse">
  <li><a href="#lower-dimensional-projections" id="toc-lower-dimensional-projections" class="nav-link" data-scroll-target="#lower-dimensional-projections">Lower-dimensional projections</a></li>
  <li><a href="#how-do-we-summarise-two-dimensional-data-by-a-line" id="toc-how-do-we-summarise-two-dimensional-data-by-a-line" class="nav-link" data-scroll-target="#how-do-we-summarise-two-dimensional-data-by-a-line">How do we summarise two-dimensional data by a line?</a></li>
  </ul></li>
  <li><a href="#the-new-linear-combinations" id="toc-the-new-linear-combinations" class="nav-link" data-scroll-target="#the-new-linear-combinations">The new linear combinations</a>
  <ul class="collapse">
  <li><a href="#optimal-lines" id="toc-optimal-lines" class="nav-link" data-scroll-target="#optimal-lines">Optimal lines</a></li>
  </ul></li>
  <li><a href="#the-pca-workflow" id="toc-the-pca-workflow" class="nav-link" data-scroll-target="#the-pca-workflow">The PCA workflow</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Chapter 7: Multivariate Analysis</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<section id="setup" class="level2">
<h2 class="anchored" data-anchor-id="setup">Setup</h2>
<p>Install required packages if missing.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>cran_packages <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"ggplot2"</span>, <span class="st">"factoextra"</span>, <span class="st">"ade4"</span>, <span class="st">"pheatmap"</span>, <span class="st">"MASS"</span>, <span class="st">"tibble"</span>)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>bioc_packages <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"SummarizedExperiment"</span>, <span class="st">"phyloseq"</span>, <span class="st">"airway"</span>, <span class="st">"Hiiragi2013"</span>, <span class="st">"Biobase"</span>)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>cran_missing <span class="ot">&lt;-</span> cran_packages[<span class="sc">!</span><span class="fu">sapply</span>(cran_packages, requireNamespace, <span class="at">quietly =</span> <span class="cn">TRUE</span>)]</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="fu">length</span>(cran_missing) <span class="sc">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">install.packages</span>(cran_missing)</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>bioc_missing <span class="ot">&lt;-</span> bioc_packages[<span class="sc">!</span><span class="fu">sapply</span>(bioc_packages, requireNamespace, <span class="at">quietly =</span> <span class="cn">TRUE</span>)]</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="fu">length</span>(bioc_missing) <span class="sc">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="sc">!</span><span class="fu">requireNamespace</span>(<span class="st">"BiocManager"</span>, <span class="at">quietly =</span> <span class="cn">TRUE</span>)) {</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">install.packages</span>(<span class="st">"BiocManager"</span>)</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>  BiocManager<span class="sc">::</span><span class="fu">install</span>(bioc_missing)</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
<section id="learning-outcomes" class="level2">
<h2 class="anchored" data-anchor-id="learning-outcomes">Learning outcomes</h2>
<ul>
<li>See examples of matrices that come up in the study of biological data.</li>
<li>Perform dimension reduction to understand correlations between variables.</li>
<li>Preprocess, rescale, and centre data before starting a multivariate analysis.</li>
<li>Build new variables, called principal components (PCs), that are more useful than the original measurements.</li>
<li>See what is “under the hood” of PCA: the singular value decomposition of a matrix.</li>
<li>Visualise what SVD achieves and learn how to choose the number of principal components.</li>
<li>Run through a complete PCA from start to finish.</li>
<li>Project factor covariates onto the PCA map for a more useful interpretation of results.</li>
</ul>
</section>
<section id="example-data" class="level2">
<h2 class="anchored" data-anchor-id="example-data">Example data</h2>
<p>The <code>turtles</code> dataset is a matrix of three dimensions of biometric measurements on painted turtles.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>turtles <span class="ot">=</span> <span class="fu">read.table</span>(<span class="st">"../data/PaintedTurtles.txt"</span>, <span class="at">header =</span> <span class="cn">TRUE</span>)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>turtles[<span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>, ]</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>  sex length width height
1   f     98    81     38
2   f    103    84     38
3   f    103    86     42
4   f    105    86     40</code></pre>
</div>
</div>
<p>The <code>athletes</code> dataset contains the performance of 33 athletes in the 10 disciplines of the <a href="https://en.wikipedia.org/wiki/Decathlon">decathlon</a>.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(<span class="st">"../data/athletes.RData"</span>)</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>athletes[<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>, ]</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>   m100 long weight highj  m400  m110  disc pole javel  m1500
1 11.25 7.43  15.48  2.27 48.90 15.13 49.28  4.7 61.32 268.95
2 10.87 7.45  14.97  1.97 47.71 14.46 44.36  5.1 61.76 273.02
3 11.18 7.44  14.20  1.97 48.29 14.81 43.66  5.2 64.16 263.20</code></pre>
</div>
</div>
<p>Summary of each decathlon event.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">stopifnot</span>(<span class="fu">nrow</span>(athletes) <span class="sc">==</span> <span class="dv">33</span>, <span class="fu">ncol</span>(athletes) <span class="sc">==</span> <span class="dv">10</span>)</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>athletesSummary <span class="ot">=</span> <span class="fu">lapply</span>(athletes, <span class="cf">function</span>(x) <span class="fu">c</span>(<span class="at">min =</span> <span class="fu">min</span>(x), <span class="at">max =</span> <span class="fu">max</span>(x), <span class="at">mean =</span> <span class="fu">mean</span>(x), <span class="at">sd =</span> <span class="fu">sd</span>(x)))</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>athletesSummary</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>$m100
      min       max      mean        sd 
10.620000 11.570000 11.196364  0.243321 

$long
      min       max      mean        sd 
6.2200000 7.7200000 7.1333333 0.3043401 

$weight
      min       max      mean        sd 
10.270000 16.600000 13.976364  1.331991 

$highj
      min       max      mean        sd 
1.7900000 2.2700000 1.9827273 0.0939838 

$m400
     min      max     mean       sd 
47.44000 51.28000 49.27667  1.06966 

$m110
       min        max       mean         sd 
14.1800000 16.2000000 15.0487879  0.5067652 

$disc
      min       max      mean        sd 
34.360000 50.660000 42.353939  3.719131 

$pole
      min       max      mean        sd 
4.0000000 5.7000000 4.7393939 0.3344206 

$javel
      min       max      mean        sd 
49.520000 72.600000 59.438788  5.495998 

$m1500
     min      max     mean       sd 
256.6400 303.1700 276.0385  13.6571 </code></pre>
</div>
</div>
<p>The <code>Msig3transp</code> dataset contains gene expression profiles of sorted T-cell populations from different subjects. The columns are a subset of gene expression measurements and correspond to 156 genes that show differential expression between cell types.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(<span class="st">"../data/Msig3transp.RData"</span>)</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(Msig3transp)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1]  30 156</code></pre>
</div>
</div>
<p>The <code>GlobalPatterns</code> dataset is from the <a href="https://bioconductor.org/packages/release/bioc/html/phyloseq.html">phyloseq</a> package. It contains counts of different species (or Operational Taxonomic Units, OTUs) of bacteria, which are identified by numerical tags. The rows are labelled according to the samples in which they were measured and the (integer) numbers represent the number of times each OTU was observed in each of the samples.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">"GlobalPatterns"</span>, <span class="at">package =</span> <span class="st">"phyloseq"</span>)</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>GPOTUs <span class="ot">=</span> <span class="fu">as.matrix</span>(<span class="fu">t</span>(phyloseq<span class="sc">::</span><span class="fu">otu_table</span>(GlobalPatterns)))</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>GPOTUs[<span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>, <span class="dv">6</span><span class="sc">:</span><span class="dv">13</span>]</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>OTU Table:          [4 taxa and 8 samples]
                     taxa are rows
        246140 143239 244960 255340 144887 141782 215972 31759
CL3          0      7      0    153      3      9      0     0
CC1          0      1      0    194      5     35      3     1
SV1          0      0      0      0      0      0      0     0
M31Fcsw      0      0      0      0      0      0      0     0</code></pre>
</div>
</div>
<p>The <code>airway</code> dataset contains RNA-seq data for different biological samples (columns).</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">"SummarizedExperiment"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: MatrixGenerics</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: matrixStats</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'MatrixGenerics'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following objects are masked from 'package:matrixStats':

    colAlls, colAnyNAs, colAnys, colAvgsPerRowSet, colCollapse,
    colCounts, colCummaxs, colCummins, colCumprods, colCumsums,
    colDiffs, colIQRDiffs, colIQRs, colLogSumExps, colMadDiffs,
    colMads, colMaxs, colMeans2, colMedians, colMins, colOrderStats,
    colProds, colQuantiles, colRanges, colRanks, colSdDiffs, colSds,
    colSums2, colTabulates, colVarDiffs, colVars, colWeightedMads,
    colWeightedMeans, colWeightedMedians, colWeightedSds,
    colWeightedVars, rowAlls, rowAnyNAs, rowAnys, rowAvgsPerColSet,
    rowCollapse, rowCounts, rowCummaxs, rowCummins, rowCumprods,
    rowCumsums, rowDiffs, rowIQRDiffs, rowIQRs, rowLogSumExps,
    rowMadDiffs, rowMads, rowMaxs, rowMeans2, rowMedians, rowMins,
    rowOrderStats, rowProds, rowQuantiles, rowRanges, rowRanks,
    rowSdDiffs, rowSds, rowSums2, rowTabulates, rowVarDiffs, rowVars,
    rowWeightedMads, rowWeightedMeans, rowWeightedMedians,
    rowWeightedSds, rowWeightedVars</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: GenomicRanges</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: stats4</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: BiocGenerics</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: generics</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'generics'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following objects are masked from 'package:base':

    as.difftime, as.factor, as.ordered, intersect, is.element, setdiff,
    setequal, union</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'BiocGenerics'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following objects are masked from 'package:stats':

    IQR, mad, sd, var, xtabs</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following objects are masked from 'package:base':

    anyDuplicated, aperm, append, as.data.frame, basename, cbind,
    colnames, dirname, do.call, duplicated, eval, evalq, Filter, Find,
    get, grep, grepl, is.unsorted, lapply, Map, mapply, match, mget,
    order, paste, pmax, pmax.int, pmin, pmin.int, Position, rank,
    rbind, Reduce, rownames, sapply, saveRDS, table, tapply, unique,
    unsplit, which.max, which.min</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: S4Vectors</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'S4Vectors'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following object is masked from 'package:utils':

    findMatches</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following objects are masked from 'package:base':

    expand.grid, I, unname</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: IRanges</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: Seqinfo</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: Biobase</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Welcome to Bioconductor

    Vignettes contain introductory material; view with
    'browseVignettes()'. To cite Bioconductor, see
    'citation("Biobase")', and for packages 'citation("pkgname")'.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'Biobase'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following object is masked from 'package:MatrixGenerics':

    rowMedians</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following objects are masked from 'package:matrixStats':

    anyMissing, rowMedians</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">"airway"</span>, <span class="at">package =</span> <span class="st">"airway"</span>)</span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a><span class="fu">assay</span>(airway)[<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>]</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>                SRR1039508 SRR1039509 SRR1039512 SRR1039513
ENSG00000000003        679        448        873        408
ENSG00000000005          0          0          0          0
ENSG00000000419        467        515        621        365</code></pre>
</div>
</div>
<p>The <code>metab</code> dataset contains aligned mass spectroscopy peaks or molecules identified through their <em>m</em> / <em>z</em> ratios; the entries in the matrix are the measured intensities.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>metab <span class="ot">=</span> <span class="fu">t</span>(<span class="fu">as.matrix</span>(<span class="fu">read.csv</span>(<span class="st">"../data/metabolites.csv"</span>, <span class="at">row.names =</span> <span class="dv">1</span>)))</span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>metab[<span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>]</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>         146.0985388 148.7053275 310.1505057 132.4512963
KOGCHUM1    29932.36    17055.70     1132.82    785.5129
KOGCHUM2    94067.61    74631.69    28240.85   5232.0499
KOGCHUM3   146411.33   147788.71    64950.49  10283.0037
WTGCHUM1   229912.57   384932.56   220730.39  26115.2007</code></pre>
</div>
</div>
<p>Frequency of zeros.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="fu">prop.table</span>(<span class="fu">table</span>(<span class="fu">as.vector</span>(GPOTUs <span class="sc">==</span> <span class="dv">0</span>)))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    FALSE      TRUE 
0.2093168 0.7906832 </code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="fu">prop.table</span>(<span class="fu">table</span>(metab <span class="sc">==</span> <span class="dv">0</span>))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    FALSE      TRUE 
0.8966461 0.1033539 </code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="fu">prop.table</span>(<span class="fu">table</span>(<span class="fu">assay</span>(airway) <span class="sc">==</span> <span class="dv">0</span>))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    FALSE      TRUE 
0.3889591 0.6110409 </code></pre>
</div>
</div>
</section>
<section id="low-dimensional-data-summaries" class="level2">
<h2 class="anchored" data-anchor-id="low-dimensional-data-summaries">Low-dimensional data summaries</h2>
<p>If we are studying only one variable, e.g., just the third column of the turtles matrix, we say we are looking at one-dimensional data. Such a vector, say all the turtle weights, can be visualised using a histogram. If we compute a one-number summary, say mean or median, we have made a zero-dimensional summary of our one-dimensional data. This is already an example of dimension reduction.</p>
<p>When considering two variables (x and y) measured together on a set of observations, the correlation coefficient measures how the variables co-vary. This is a single-number summary of two-dimensional data. Its formula involves the summaries <span class="math inline">\(\bar{x}\)</span> and <span class="math inline">\(\bar{y}\)</span>:</p>
<p><span class="math display">\[
\hat{p} = \frac{\sum^n_{i=1}(x_i - \bar{x})(y_i - \bar{y})}{\sqrt{\sum^n_{i=1}(x_i - \bar{x})^2} \sqrt{\sum^n_{j=1}(y_j - \bar{y})^2}}
\]</span></p>
<p>In R, the <code>cor</code> function calculates the correlation coefficient and when applied to a matrix, this function computes all the two-way correlations between continuous variables.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cor</span>(turtles[, <span class="sc">-</span><span class="dv">1</span>])</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>          length     width    height
length 1.0000000 0.9783116 0.9646946
width  0.9783116 1.0000000 0.9605705
height 0.9646946 0.9605705 1.0000000</code></pre>
</div>
</div>
<p>All the values are close to 1 and it seems that all three variables mostly reflect the same “underlying” variable, which we might interpret as the <em>size</em> of the turtle.</p>
</section>
<section id="preprocessing-the-data" class="level2">
<h2 class="anchored" data-anchor-id="preprocessing-the-data">Preprocessing the data</h2>
<p>In many cases, different variables are measured in different units, so they have different baselines and different scales. These are not directly comparable in their original form.</p>
<p>For PCA and many other methods, we therefore need to transform the numeric values to some common scale in order to make comparisons meaningful.</p>
<ul>
<li><strong>Centering</strong> means subtracting the mean, so that the mean of the centered data is at the origin.</li>
<li><strong>Scaling</strong> or <strong>standardising</strong> means dividing by the standard deviation, so that the new standard deviation is 1.</li>
</ul>
<p>The <strong>correlation coefficient</strong> is simply the vector product of the centered and scaled variables. To perform these operations, there is the <code>scale</code> function, whose default behaviour when given a matrix or data frame is to make every column have a mean of 0 and a standard deviation of 1.</p>
<p>Standard deviation and mean before scaling.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="fu">apply</span>(turtles[,<span class="sc">-</span><span class="dv">1</span>], <span class="dv">2</span>, sd)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>   length     width    height 
20.481602 12.675838  8.392837 </code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="fu">apply</span>(turtles[,<span class="sc">-</span><span class="dv">1</span>], <span class="dv">2</span>, mean)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>   length     width    height 
124.68750  95.43750  46.33333 </code></pre>
</div>
</div>
<p>Standard deviation and mean after scaling.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb53"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a>scaledTurtles <span class="ot">=</span> <span class="fu">scale</span>(turtles[, <span class="sc">-</span><span class="dv">1</span>])</span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a><span class="fu">apply</span>(scaledTurtles, <span class="dv">2</span>, mean)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>       length         width        height 
-1.432050e-18  1.940383e-17 -2.870967e-16 </code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb55"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a><span class="fu">apply</span>(scaledTurtles, <span class="dv">2</span>, sd)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>length  width height 
     1      1      1 </code></pre>
</div>
</div>
<p>Plot scaled data.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb57"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a><span class="fu">data.frame</span>(scaledTurtles, <span class="at">sex =</span> turtles[, <span class="dv">1</span>]) <span class="sc">|&gt;</span></span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> width, <span class="at">y =</span> height, <span class="at">group =</span> sex)) <span class="sc">+</span></span>
<span id="cb57-4"><a href="#cb57-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">color =</span> sex)) <span class="sc">+</span> <span class="fu">coord_fixed</span>()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="07-chap_files/figure-html/unnamed-chunk-4-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>The aim of transformations is (usually) variance stabilisation, i.e., to make the variances of replicate measurements of <em>one and the same variable</em> in different parts of its dynamic range more similar. The standardising transformation using <code>scale</code> aims to make the scale (as measured by mean and standard deviation) of <em>different variables</em> the same.</p>
<p>Sometimes it is preferable to leave variables at different scales because they are truly of different importance. If their original scale is relevant, then we can (and should) leave the data alone. After pre-processing the data, we are ready to undertake <strong>data simplification</strong> through <strong>dimension reduction</strong>.</p>
</section>
<section id="dimension-reduction" class="level2">
<h2 class="anchored" data-anchor-id="dimension-reduction">Dimension reduction</h2>
<p>Dimension reduction was invented in 1901 by Karl Pearson as a way of reducing a two-variable scatterplot to a single coordinate. It was used by statisticians in the 1930s to summarise a battery of psychological tests run on the same subjects, thus providing overall scores that summarise many test variables at once. This idea of <strong>principal</strong> scores inspired the name principal component analysis (PCA).</p>
<p>PCA is called an <strong>unsupervised learning</strong> technique because, as in clustering, it treats all variables as having the same <strong>status</strong>. We are not trying to predict or explain one particular variable’s value from the others; rather, we are trying to find a mathematical model for an underlying structure for all the variables.</p>
<p>PCA is primarily an exploratory technique that produces maps that show the relations between variables and between observations in a useful way.</p>
<p>We use geometric <strong>projections</strong> that take points in higher-dimensional spaces and project them down onto lower dimensions. In the example below, point A is projected onto the red line generated by the vector <span class="math inline">\(v\)</span>. The dashed projection line is perpendicular (or orthogonal) to the red line. The intersection point of the projection line and the red line is called the orthogonal projection of A onto the red line generated by the vector <span class="math inline">\(v\)</span>.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb58"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a>x1<span class="ot">=</span><span class="dv">1</span>;x2<span class="ot">=</span><span class="dv">3</span>;y1<span class="ot">=</span><span class="dv">1</span>;y2<span class="ot">=</span><span class="dv">2</span>;ax<span class="ot">=</span><span class="fl">2.5</span>;ay<span class="ot">=</span><span class="dv">3</span>;</span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a>df<span class="ot">=</span><span class="fu">data.frame</span>(<span class="at">x=</span><span class="fu">c</span>(x1,x2,ax),<span class="at">y=</span><span class="fu">c</span>(y1,y2,ay))</span>
<span id="cb58-3"><a href="#cb58-3" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(df, <span class="fu">aes</span>(<span class="at">x=</span>x,<span class="at">y=</span>y)) <span class="sc">+</span> </span>
<span id="cb58-4"><a href="#cb58-4" aria-hidden="true" tabindex="-1"></a>       <span class="fu">geom_point</span>(<span class="at">size=</span><span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb58-5"><a href="#cb58-5" aria-hidden="true" tabindex="-1"></a>       <span class="fu">geom_abline</span>(<span class="at">intercept=</span><span class="fl">0.5</span>,<span class="at">slope=</span><span class="fl">0.5</span>, <span class="at">color=</span><span class="st">"red"</span>, <span class="at">linewidth=</span><span class="fl">1.3</span>) <span class="sc">+</span> </span>
<span id="cb58-6"><a href="#cb58-6" aria-hidden="true" tabindex="-1"></a>       <span class="fu">xlim</span>(<span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">4</span>)) <span class="sc">+</span> </span>
<span id="cb58-7"><a href="#cb58-7" aria-hidden="true" tabindex="-1"></a>       <span class="fu">ylim</span>(<span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">4</span>)) <span class="sc">+</span></span>
<span id="cb58-8"><a href="#cb58-8" aria-hidden="true" tabindex="-1"></a>       <span class="fu">geom_segment</span>(<span class="at">x=</span>x1,<span class="at">y=</span>y1,<span class="at">xend=</span>x2<span class="fl">-0.5</span>,<span class="at">yend=</span>y2<span class="fl">-0.25</span>,<span class="at">arrow=</span><span class="fu">arrow</span>(<span class="at">length =</span> <span class="fu">unit</span>(<span class="fl">0.3</span>,<span class="st">"cm"</span>)),<span class="at">color=</span><span class="st">"blue"</span>) <span class="sc">+</span></span>
<span id="cb58-9"><a href="#cb58-9" aria-hidden="true" tabindex="-1"></a>       <span class="fu">geom_segment</span>(<span class="at">x=</span>ax,<span class="at">y=</span>ay,<span class="at">xend=</span>x2,<span class="at">yend=</span>y2,<span class="at">arrow=</span><span class="fu">arrow</span>(<span class="at">length =</span> <span class="fu">unit</span>(<span class="fl">0.3</span>,<span class="st">"cm"</span>)),<span class="at">color=</span><span class="st">"orange"</span>,</span>
<span id="cb58-10"><a href="#cb58-10" aria-hidden="true" tabindex="-1"></a>                    <span class="at">linetype =</span> <span class="dv">5</span>, <span class="at">linewidth =</span> <span class="fl">1.2</span>, <span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span> </span>
<span id="cb58-11"><a href="#cb58-11" aria-hidden="true" tabindex="-1"></a>       <span class="fu">annotate</span>(<span class="st">"text"</span>, <span class="at">x =</span> ax<span class="fl">+0.2</span>, <span class="at">y =</span> ay<span class="fl">+0.15</span>, <span class="at">label =</span> <span class="st">"A"</span>, <span class="at">size=</span><span class="dv">6</span>) <span class="sc">+</span></span>
<span id="cb58-12"><a href="#cb58-12" aria-hidden="true" tabindex="-1"></a>       <span class="fu">annotate</span>(<span class="st">"text"</span>, <span class="at">x =</span> x2, <span class="at">y =</span> y2<span class="fl">-0.5</span>, <span class="at">label =</span> <span class="st">"proj_v(A)"</span>, <span class="at">size=</span><span class="dv">6</span>) <span class="sc">+</span></span>
<span id="cb58-13"><a href="#cb58-13" aria-hidden="true" tabindex="-1"></a>       <span class="fu">annotate</span>(<span class="st">"text"</span>, <span class="at">x =</span> x1<span class="fl">+0.75</span>, <span class="at">y =</span> y1<span class="fl">+0.24</span>, <span class="at">label =</span> <span class="st">"v"</span>, <span class="at">size=</span><span class="dv">6</span>, <span class="at">color=</span><span class="st">"blue"</span>) <span class="sc">+</span></span>
<span id="cb58-14"><a href="#cb58-14" aria-hidden="true" tabindex="-1"></a>       <span class="fu">annotate</span>(<span class="st">"text"</span>, <span class="at">x =</span> x1<span class="fl">-0.2</span>, <span class="at">y =</span> y1<span class="sc">+</span> <span class="fl">0.2</span>, <span class="at">label =</span> <span class="st">"O"</span>, <span class="at">size=</span><span class="dv">6</span>) <span class="sc">+</span></span>
<span id="cb58-15"><a href="#cb58-15" aria-hidden="true" tabindex="-1"></a>       <span class="fu">coord_fixed</span>() <span class="sc">+</span> </span>
<span id="cb58-16"><a href="#cb58-16" aria-hidden="true" tabindex="-1"></a>       <span class="fu">theme_void</span>() <span class="sc">+</span></span>
<span id="cb58-17"><a href="#cb58-17" aria-hidden="true" tabindex="-1"></a>       <span class="fu">geom_point</span>(<span class="at">size=</span><span class="dv">2</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="07-chap_files/figure-html/figure_7.5-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>PCA is a <strong>linear</strong> technique, meaning that we look for linear relations between variables and that we will use new variables that are linear functions of the original ones (<span class="math inline">\(f(ax + by) = af(x) + b(y)\)</span>). The linearity constraint makes computations particularly easy.</p>
<section id="lower-dimensional-projections" class="level3">
<h3 class="anchored" data-anchor-id="lower-dimensional-projections">Lower-dimensional projections</h3>
<p>The code below shows one way of projecting two-dimensional data onto a line.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb59"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(<span class="st">"../data/athletes.RData"</span>)</span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a>athletes <span class="ot">=</span> <span class="fu">data.frame</span>(<span class="fu">scale</span>(athletes))</span>
<span id="cb59-3"><a href="#cb59-3" aria-hidden="true" tabindex="-1"></a>ath_gg <span class="ot">=</span> <span class="fu">ggplot</span>(athletes, <span class="fu">aes</span>(<span class="at">x =</span> weight, <span class="at">y =</span> disc)) <span class="sc">+</span></span>
<span id="cb59-4"><a href="#cb59-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">2</span>, <span class="at">shape =</span> <span class="dv">21</span>)</span>
<span id="cb59-5"><a href="#cb59-5" aria-hidden="true" tabindex="-1"></a>ath_gg <span class="sc">+</span> <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">y =</span> <span class="dv">0</span>), <span class="at">colour =</span> <span class="st">"red"</span>) <span class="sc">+</span></span>
<span id="cb59-6"><a href="#cb59-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_segment</span>(<span class="fu">aes</span>(<span class="at">xend =</span> weight, <span class="at">yend =</span> <span class="dv">0</span>), <span class="at">linetype =</span> <span class="st">"dashed"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="07-chap_files/figure-html/unnamed-chunk-5-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>The scatterplot shows two variables (weight and disc) that is projected onto the horizontal x-axis (defined by <span class="math inline">\(y = 0\)</span>) in red, and the lines of projection appear as dashed.</p>
</section>
<section id="how-do-we-summarise-two-dimensional-data-by-a-line" class="level3">
<h3 class="anchored" data-anchor-id="how-do-we-summarise-two-dimensional-data-by-a-line">How do we summarise two-dimensional data by a line?</h3>
<p>In general, we lose information about the points when we project from two dimensions (a plane) onto one (a line). If we do it just by using the original coordinates, as we did on the <code>weight</code> variable above, we lose all the information about the <code>disc</code> variable.</p>
<p>Our goal is to keep as much information as we can about <em>both</em> variables. There are actually many ways of projecting a point cloud onto a line. One is to use what are known as <strong>regressionlines</strong>.</p>
<section id="regressing-one-variable-on-the-other" class="level4">
<h4 class="anchored" data-anchor-id="regressing-one-variable-on-the-other">Regressing one variable on the other</h4>
<p><strong>Linear regression</strong> is a <strong>supervised</strong> method that gives preference to minimising the residual sum of squares in one direction: that of the response variable.</p>
<p>Below we use the <code>lm</code> (linear model) function to find the regression line. Its slope and intercept are given by the values in the <code>coefficients</code> slot of the resulting object <code>reg1</code>.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb60"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a>reg1 <span class="ot">=</span> <span class="fu">lm</span>(disc <span class="sc">~</span> weight, <span class="at">data =</span> athletes)</span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a>a1 <span class="ot">=</span> reg1<span class="sc">$</span>coefficients[<span class="dv">1</span>] <span class="co"># intercept</span></span>
<span id="cb60-3"><a href="#cb60-3" aria-hidden="true" tabindex="-1"></a>b1 <span class="ot">=</span> reg1<span class="sc">$</span>coefficients[<span class="dv">2</span>] <span class="co"># slope</span></span>
<span id="cb60-4"><a href="#cb60-4" aria-hidden="true" tabindex="-1"></a>pline1 <span class="ot">=</span> ath_gg <span class="sc">+</span> <span class="fu">geom_abline</span>(<span class="at">intercept =</span> a1, <span class="at">slope =</span> b1,</span>
<span id="cb60-5"><a href="#cb60-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">col =</span> <span class="st">"blue"</span>, <span class="at">linewidth =</span> <span class="fl">1.5</span>)</span>
<span id="cb60-6"><a href="#cb60-6" aria-hidden="true" tabindex="-1"></a>pline1 <span class="sc">+</span> <span class="fu">geom_segment</span>(<span class="fu">aes</span>(<span class="at">xend =</span> weight, <span class="at">yend =</span> reg1<span class="sc">$</span>fitted),</span>
<span id="cb60-7"><a href="#cb60-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">colour =</span> <span class="st">"red"</span>, <span class="at">arrow =</span> <span class="fu">arrow</span>(<span class="at">length =</span> <span class="fu">unit</span>(<span class="fl">0.15</span>, <span class="st">"cm"</span>)))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="07-chap_files/figure-html/unnamed-chunk-6-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>The blue line minimises the sum of squares of the vertical residuals (in red).</p>
<p>The code below shows the line produced when the roles of the two variables are reversed; <code>weight</code> becomes the response variable.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb61"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a>reg2 <span class="ot">=</span> <span class="fu">lm</span>(weight <span class="sc">~</span> disc, <span class="at">data =</span> athletes)</span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a>a2 <span class="ot">=</span> reg2<span class="sc">$</span>coefficients[<span class="dv">1</span>] <span class="co"># intercept</span></span>
<span id="cb61-3"><a href="#cb61-3" aria-hidden="true" tabindex="-1"></a>b2 <span class="ot">=</span> reg2<span class="sc">$</span>coefficients[<span class="dv">2</span>] <span class="co"># slope</span></span>
<span id="cb61-4"><a href="#cb61-4" aria-hidden="true" tabindex="-1"></a>pline2 <span class="ot">=</span> ath_gg <span class="sc">+</span> <span class="fu">geom_abline</span>(<span class="at">intercept =</span> <span class="sc">-</span>a2<span class="sc">/</span>b2, <span class="at">slope =</span> <span class="dv">1</span><span class="sc">/</span>b2,</span>
<span id="cb61-5"><a href="#cb61-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">col =</span> <span class="st">"darkgreen"</span>, <span class="at">linewidth =</span> <span class="fl">1.5</span>)</span>
<span id="cb61-6"><a href="#cb61-6" aria-hidden="true" tabindex="-1"></a>pline2 <span class="sc">+</span> <span class="fu">geom_segment</span>(<span class="fu">aes</span>(<span class="at">xend=</span>reg2<span class="sc">$</span>fitted, <span class="at">yend=</span>disc),</span>
<span id="cb61-7"><a href="#cb61-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">colour =</span> <span class="st">"orange"</span>, <span class="at">arrow =</span> <span class="fu">arrow</span>(<span class="at">length =</span> <span class="fu">unit</span>(<span class="fl">0.15</span>, <span class="st">"cm"</span>)))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="07-chap_files/figure-html/unnamed-chunk-7-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>The green line minimises the sum of squares of the horizontal residuals (in orange).</p>
<p>Each of the regression lines gives us an approximate linear relationship between <code>disc</code> and <code>weight</code>. However, the relationship differs depending on which variable we choose to be the <strong>predictor</strong> and which the <strong>response</strong>.</p>
<p>How large is the variance of the projected points that lie on the blue regression line? Compare this to the variance of the data when projected on the original axes, <code>weight</code> and <code>disc</code>.</p>
<p>Pythagoras’ theorem tells us that the square of the hypotenuse of a right-angled triangle is equal to the sum of the squares of the other two sides, which we apply as follows.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb62"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a><span class="fu">var</span>(athletes<span class="sc">$</span>weight) <span class="sc">+</span> <span class="fu">var</span>(reg1<span class="sc">$</span>fitted)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1.650204</code></pre>
</div>
</div>
<p>The variances of the points along the original axes <code>weight</code> and <code>disc</code> are 1, since we scaled the variables.</p>
<p>Variance of the projected points that lie on the green regression line.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb64"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a><span class="fu">var</span>(athletes<span class="sc">$</span>disc) <span class="sc">+</span> <span class="fu">var</span>(reg2<span class="sc">$</span>fitted)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1.650204</code></pre>
</div>
</div>
</section>
<section id="a-line-that-minimises-distance-in-both-directions" class="level4">
<h4 class="anchored" data-anchor-id="a-line-that-minimises-distance-in-both-directions">A line that minimises distance in both directions</h4>
<p>The code below generates a line that minimises the sum of squares of the orthogonal (perpendicular) projections of data points onto it; we call this the <strong>principal component</strong> line.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb66"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a><span class="fu">stopifnot</span>(<span class="fu">all.equal</span>(<span class="fu">c</span>(<span class="fu">var</span>(athletes<span class="sc">$</span>weight), <span class="fu">var</span>(athletes<span class="sc">$</span>disc)), <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>)))</span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a>xy <span class="ot">=</span> <span class="fu">cbind</span>(athletes<span class="sc">$</span>disc, athletes<span class="sc">$</span>weight)</span>
<span id="cb66-3"><a href="#cb66-3" aria-hidden="true" tabindex="-1"></a>svda <span class="ot">=</span> <span class="fu">svd</span>(xy)</span>
<span id="cb66-4"><a href="#cb66-4" aria-hidden="true" tabindex="-1"></a>pc <span class="ot">=</span> xy <span class="sc">%*%</span> svda<span class="sc">$</span>v[, <span class="dv">1</span>] <span class="sc">%*%</span> <span class="fu">t</span>(svda<span class="sc">$</span>v[, <span class="dv">1</span>])</span>
<span id="cb66-5"><a href="#cb66-5" aria-hidden="true" tabindex="-1"></a>bp <span class="ot">=</span> svda<span class="sc">$</span>v[<span class="dv">2</span>, <span class="dv">1</span>] <span class="sc">/</span> svda<span class="sc">$</span>v[<span class="dv">1</span>, <span class="dv">1</span>]</span>
<span id="cb66-6"><a href="#cb66-6" aria-hidden="true" tabindex="-1"></a>ap <span class="ot">=</span> <span class="fu">mean</span>(pc[, <span class="dv">2</span>]) <span class="sc">-</span> bp <span class="sc">*</span> <span class="fu">mean</span>(pc[, <span class="dv">1</span>])</span>
<span id="cb66-7"><a href="#cb66-7" aria-hidden="true" tabindex="-1"></a>ath_gg <span class="sc">+</span> <span class="fu">geom_segment</span>(<span class="at">xend =</span> pc[, <span class="dv">1</span>], <span class="at">yend =</span> pc[, <span class="dv">2</span>]) <span class="sc">+</span></span>
<span id="cb66-8"><a href="#cb66-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_abline</span>(<span class="at">intercept =</span> ap, <span class="at">slope =</span> bp, <span class="at">col =</span> <span class="st">"purple"</span>, <span class="at">linewidth =</span> <span class="fl">1.5</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="07-chap_files/figure-html/unnamed-chunk-10-1.png" class="img-fluid figure-img" width="576"></p>
</figure>
</div>
</div>
</div>
<p>All of the three ways of fitting a line are shown together in the plot below.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb67"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a>pline1 <span class="sc">+</span> <span class="fu">geom_segment</span>(<span class="fu">aes</span>(<span class="at">xend =</span> weight, <span class="at">yend =</span> reg1<span class="sc">$</span>fitted), <span class="at">colour =</span> <span class="st">"blue"</span>, <span class="at">alpha =</span> <span class="fl">0.35</span>) <span class="sc">+</span></span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_abline</span>(<span class="at">intercept =</span> <span class="sc">-</span>a2<span class="sc">/</span>b2, <span class="at">slope =</span> <span class="dv">1</span><span class="sc">/</span>b2, <span class="at">col =</span> <span class="st">"darkgreen"</span>, <span class="at">linewidth =</span> <span class="fl">1.5</span>, <span class="at">alpha =</span> <span class="fl">0.8</span>) <span class="sc">+</span></span>
<span id="cb67-3"><a href="#cb67-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_segment</span>(<span class="fu">aes</span>(<span class="at">xend =</span> reg2<span class="sc">$</span>fitted, <span class="at">yend =</span> disc), <span class="at">colour =</span> <span class="st">"orange"</span>, <span class="at">alpha =</span> <span class="fl">0.35</span>) <span class="sc">+</span></span>
<span id="cb67-4"><a href="#cb67-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_abline</span>(<span class="at">intercept =</span> ap, <span class="at">slope =</span> bp, <span class="at">col =</span> <span class="st">"purple"</span>, <span class="at">linewidth =</span> <span class="fl">1.5</span>, <span class="at">alpha =</span> <span class="fl">0.8</span>) <span class="sc">+</span></span>
<span id="cb67-5"><a href="#cb67-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_segment</span>(<span class="at">xend =</span> pc[, <span class="dv">1</span>], <span class="at">yend =</span> pc[, <span class="dv">2</span>], <span class="at">colour =</span> <span class="st">"purple"</span>, <span class="at">alpha =</span> <span class="fl">0.35</span>) <span class="sc">+</span> <span class="fu">coord_fixed</span>()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="07-chap_files/figure-html/unnamed-chunk-11-1.png" class="img-fluid figure-img" width="576"></p>
</figure>
</div>
</div>
</div>
<p>The purple PCA line cuts exactly in the middle of both regression lines. The blue line minimises the sum of squares of the vertical residuals, the green line minimises the horizontal residuals, and the purple line, called the principal component, minimises the orthogonal projections.</p>
<p>The variance of the points on the purple line can be calculated by using <code>var</code> on the new coordinates.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb68"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a><span class="fu">apply</span>(pc, <span class="dv">2</span>, var)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.9031761 0.9031761</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb70"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(<span class="fu">apply</span>(pc, <span class="dv">2</span>, var))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1.806352</code></pre>
</div>
</div>
<p>The variance along the purple line is larger than the variance using the regression lines.</p>
<p>Pythagoras’ theorem tells us two interesting things here:</p>
<ol type="1">
<li>If we are minimising in both horizontal and vertical directions, we are in fact minimising the orthogonal projections onto the line from each point.</li>
<li>The total variability of the points is measured by the sum of squares of the projection of the points onto the center of gravity, which is the origin (0,0) if the data are centered. This is called the <em>total variance</em> or the <strong>inertia</strong> of the point cloud. This inertia can be decomposed into the sum of the squares of the projections onto the line plus the variances along that line. For a fixed variance, minimising the projection distances also maximises the variance along that line. Often we define the first principal component as the line with maximum variance.</li>
</ol>
</section>
</section>
</section>
<section id="the-new-linear-combinations" class="level2">
<h2 class="anchored" data-anchor-id="the-new-linear-combinations">The new linear combinations</h2>
<p>The PC line we found in the previous section could be written:</p>
<p><span class="math display">\[
PC = \frac{1}{2}disc + \frac{1}{2}weight
\]</span></p>
<p>Principal components are <em>linear combinations</em> of the variables that were originally measured: they provide a <em>new coordinate system</em>. To understand what a <strong>linear combination</strong> really is, we can take an analogy. When making a juice mix, you will follow a recipe like:</p>
<p><span class="math display">\[
V = 2 \times Beet + 1 \times Carrot + \frac{1}{2} Gala + \frac{1}{2}GrannySmith + 0.02 \times Ginger + 0.25 \times lemon
\]</span></p>
<p>This recipe is a linear combination of individual juice types (the original variables). The result is a new variable, V, and the coefficients (2, 1, 0.5, 0.5, 0.02, 0.25) are called the <strong>loadings</strong>.</p>
<section id="optimal-lines" class="level3">
<h3 class="anchored" data-anchor-id="optimal-lines">Optimal lines</h3>
<p>A linear combination of variables defines a line in higher dimensions in the same way we constructed lines in the scatterplot plane of two dimensions. As we saw in that case, there are many ways to choose lines onto which we project the data; there is, however, a “best” line for our purpose.</p>
<p>The total variance of all the points in all the variables can be decomposed. In PCA, we use the fact that the total sums of squares of the distances between the points and any line can be decomposed into the distance to the line and the variance along the line.</p>
<p>We saw that the principal component mimimises the distance to the line, and it also maximises the variance of the projections along the line.</p>
</section>
</section>
<section id="the-pca-workflow" class="level2">
<h2 class="anchored" data-anchor-id="the-pca-workflow">The PCA workflow</h2>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb72"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a>.savedopt <span class="ot">=</span> <span class="fu">options</span>(<span class="at">digits =</span> <span class="dv">3</span>)</span>
<span id="cb72-2"><a href="#cb72-2" aria-hidden="true" tabindex="-1"></a>X <span class="ot">=</span> <span class="fu">matrix</span>(<span class="fu">c</span>(<span class="dv">780</span>,  <span class="dv">75</span>, <span class="dv">540</span>,</span>
<span id="cb72-3"><a href="#cb72-3" aria-hidden="true" tabindex="-1"></a>             <span class="dv">936</span>,  <span class="dv">90</span>, <span class="dv">648</span>,</span>
<span id="cb72-4"><a href="#cb72-4" aria-hidden="true" tabindex="-1"></a>            <span class="dv">1300</span>, <span class="dv">125</span>, <span class="dv">900</span>,</span>
<span id="cb72-5"><a href="#cb72-5" aria-hidden="true" tabindex="-1"></a>             <span class="dv">728</span>,  <span class="dv">70</span>, <span class="dv">504</span>), <span class="at">nrow =</span> <span class="dv">3</span>)</span>
<span id="cb72-6"><a href="#cb72-6" aria-hidden="true" tabindex="-1"></a>u <span class="ot">=</span> <span class="fu">c</span>(<span class="fl">0.8196</span>, <span class="fl">0.0788</span>, <span class="fl">0.5674</span>)</span>
<span id="cb72-7"><a href="#cb72-7" aria-hidden="true" tabindex="-1"></a>v <span class="ot">=</span> <span class="fu">c</span>(<span class="fl">0.4053</span>, <span class="fl">0.4863</span>, <span class="fl">0.6754</span>, <span class="fl">0.3782</span>)</span>
<span id="cb72-8"><a href="#cb72-8" aria-hidden="true" tabindex="-1"></a>s1 <span class="ot">=</span> <span class="fl">2348.2</span></span>
<span id="cb72-9"><a href="#cb72-9" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(u<span class="sc">^</span><span class="dv">2</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb74"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(v<span class="sc">^</span><span class="dv">2</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb76"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a>s1 <span class="sc">*</span> u <span class="sc">%*%</span> <span class="fu">t</span>(v)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>     [,1] [,2] [,3] [,4]
[1,]  780  936 1300  728
[2,]   75   90  125   70
[3,]  540  648  900  504</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb78"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a>X <span class="sc">-</span> s1 <span class="sc">*</span> u <span class="sc">%*%</span> <span class="fu">t</span>(v)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>         [,1]   [,2]   [,3]   [,4]
[1,] -0.03419 0.0745 0.1355 0.1221
[2,]  0.00403 0.0159 0.0252 0.0186
[3,] -0.00903 0.0691 0.1182 0.0982</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb80"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(.savedopt)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb81"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a><span class="fu">svd</span>(X)<span class="sc">$</span>u[, <span class="dv">1</span>]</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.81963482 0.07881104 0.56743949</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb83"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a><span class="fu">svd</span>(X)<span class="sc">$</span>v[, <span class="dv">1</span>]</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.4052574 0.4863089 0.6754290 0.3782403</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb85"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(<span class="fu">svd</span>(X)<span class="sc">$</span>u[, <span class="dv">1</span>]<span class="sc">^</span><span class="dv">2</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb87"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(<span class="fu">svd</span>(X)<span class="sc">$</span>v[, <span class="dv">1</span>]<span class="sc">^</span><span class="dv">2</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb89"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb89-1"><a href="#cb89-1" aria-hidden="true" tabindex="-1"></a><span class="fu">svd</span>(X)<span class="sc">$</span>d</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 2.348244e+03 2.141733e-13 6.912584e-15</code></pre>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb91"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb91-1"><a href="#cb91-1" aria-hidden="true" tabindex="-1"></a>Xtwo <span class="ot">=</span> <span class="fu">matrix</span>(<span class="fu">c</span>(<span class="fl">12.5</span>, <span class="fl">35.0</span>, <span class="fl">25.0</span>, <span class="dv">25</span>, <span class="dv">9</span>, <span class="dv">14</span>, <span class="dv">26</span>, <span class="dv">18</span>, <span class="dv">16</span>, <span class="dv">21</span>, <span class="dv">49</span>, <span class="dv">32</span>,</span>
<span id="cb91-2"><a href="#cb91-2" aria-hidden="true" tabindex="-1"></a>       <span class="dv">18</span>, <span class="dv">28</span>, <span class="dv">52</span>, <span class="dv">36</span>, <span class="dv">18</span>, <span class="fl">10.5</span>, <span class="fl">64.5</span>, <span class="dv">36</span>), <span class="at">ncol =</span> <span class="dv">4</span>, <span class="at">byrow =</span> <span class="cn">TRUE</span>)</span>
<span id="cb91-3"><a href="#cb91-3" aria-hidden="true" tabindex="-1"></a>USV <span class="ot">=</span> <span class="fu">svd</span>(Xtwo)</span>
<span id="cb91-4"><a href="#cb91-4" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(USV)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "d" "u" "v"</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb93"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb93-1"><a href="#cb93-1" aria-hidden="true" tabindex="-1"></a>USV<span class="sc">$</span>d</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1.350624e+02 2.805191e+01 3.103005e-15 1.849559e-15</code></pre>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb95"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb95-1"><a href="#cb95-1" aria-hidden="true" tabindex="-1"></a>Xtwo <span class="sc">-</span> USV<span class="sc">$</span>d[<span class="dv">1</span>] <span class="sc">*</span> USV<span class="sc">$</span>u[, <span class="dv">1</span>] <span class="sc">%*%</span> <span class="fu">t</span>(USV<span class="sc">$</span>v[, <span class="dv">1</span>])</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>            [,1]       [,2]        [,3]        [,4]
[1,]  0.87481760  19.045230 -10.1044650  1.74963521
[2,]  0.08079747   1.759002  -0.9332405  0.16159494
[3,] -0.04700978  -1.023427   0.5429803 -0.09401956
[4,]  0.16159494   3.518005  -1.8664809  0.32318987
[5,] -0.69632883 -15.159437   8.0428540 -1.39265765</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb97"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb97-1"><a href="#cb97-1" aria-hidden="true" tabindex="-1"></a>Xtwo <span class="sc">-</span> USV<span class="sc">$</span>d[<span class="dv">1</span>] <span class="sc">*</span> USV<span class="sc">$</span>u[, <span class="dv">1</span>] <span class="sc">%*%</span> <span class="fu">t</span>(USV<span class="sc">$</span>v[, <span class="dv">1</span>]) <span class="sc">-</span></span>
<span id="cb97-2"><a href="#cb97-2" aria-hidden="true" tabindex="-1"></a>       USV<span class="sc">$</span>d[<span class="dv">2</span>] <span class="sc">*</span> USV<span class="sc">$</span>u[, <span class="dv">2</span>] <span class="sc">%*%</span> <span class="fu">t</span>(USV<span class="sc">$</span>v[, <span class="dv">2</span>])</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>             [,1]          [,2]         [,3]         [,4]
[1,] 7.216450e-15 -1.065814e-14 8.881784e-15 4.884981e-15
[2,] 2.040035e-15 -5.995204e-15 1.054712e-14 3.219647e-15
[3,] 2.865763e-15 -9.547918e-15 1.554312e-15 6.231127e-15
[4,] 4.385381e-15 -5.773160e-15 1.776357e-14 7.049916e-15
[5,] 5.107026e-15 -1.776357e-15 1.776357e-14 1.776357e-14</code></pre>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb99"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb99-1"><a href="#cb99-1" aria-hidden="true" tabindex="-1"></a><span class="fu">stopifnot</span>(<span class="fu">max</span>(<span class="fu">abs</span>(</span>
<span id="cb99-2"><a href="#cb99-2" aria-hidden="true" tabindex="-1"></a>Xtwo <span class="sc">-</span> USV<span class="sc">$</span>d[<span class="dv">1</span>] <span class="sc">*</span> USV<span class="sc">$</span>u[, <span class="dv">1</span>] <span class="sc">%*%</span> <span class="fu">t</span>(USV<span class="sc">$</span>v[, <span class="dv">1</span>]) <span class="sc">-</span></span>
<span id="cb99-3"><a href="#cb99-3" aria-hidden="true" tabindex="-1"></a>       USV<span class="sc">$</span>d[<span class="dv">2</span>] <span class="sc">*</span> USV<span class="sc">$</span>u[, <span class="dv">2</span>] <span class="sc">%*%</span> <span class="fu">t</span>(USV<span class="sc">$</span>v[, <span class="dv">2</span>]))) <span class="sc">&lt;</span> <span class="fl">1e-12</span>,</span>
<span id="cb99-4"><a href="#cb99-4" aria-hidden="true" tabindex="-1"></a><span class="fu">max</span>(<span class="fu">abs</span>(USV<span class="sc">$</span>d[<span class="dv">3</span><span class="sc">:</span><span class="dv">4</span>])) <span class="sc">&lt;</span> <span class="fl">1e-13</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb100"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb100-1"><a href="#cb100-1" aria-hidden="true" tabindex="-1"></a><span class="fu">t</span>(USV<span class="sc">$</span>u) <span class="sc">%*%</span> USV<span class="sc">$</span>u</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>              [,1]          [,2]          [,3]          [,4]
[1,]  1.000000e+00 -1.665335e-16  0.000000e+00 -8.326673e-17
[2,] -1.665335e-16  1.000000e+00  1.665335e-16 -5.551115e-17
[3,]  0.000000e+00  1.665335e-16  1.000000e+00 -5.551115e-17
[4,] -8.326673e-17 -5.551115e-17 -5.551115e-17  1.000000e+00</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb102"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb102-1"><a href="#cb102-1" aria-hidden="true" tabindex="-1"></a><span class="fu">t</span>(USV<span class="sc">$</span>v) <span class="sc">%*%</span> USV<span class="sc">$</span>v</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>              [,1]          [,2]          [,3]          [,4]
[1,]  1.000000e+00  8.326673e-17  1.387779e-17 -5.551115e-17
[2,]  8.326673e-17  1.000000e+00 -3.642919e-17 -6.938894e-17
[3,]  1.387779e-17 -3.642919e-17  1.000000e+00  2.775558e-17
[4,] -5.551115e-17 -6.938894e-17  2.775558e-17  1.000000e+00</code></pre>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb104"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb104-1"><a href="#cb104-1" aria-hidden="true" tabindex="-1"></a>turtles.svd <span class="ot">=</span> <span class="fu">svd</span>(scaledTurtles)</span>
<span id="cb104-2"><a href="#cb104-2" aria-hidden="true" tabindex="-1"></a>turtles.svd<span class="sc">$</span>d</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 11.746475  1.419035  1.003329</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb106"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb106-1"><a href="#cb106-1" aria-hidden="true" tabindex="-1"></a>turtles.svd<span class="sc">$</span>v</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>          [,1]       [,2]        [,3]
[1,] 0.5787981  0.3250273  0.74789704
[2,] 0.5779840  0.4834699 -0.65741263
[3,] 0.5752628 -0.8127817 -0.09197088</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb108"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb108-1"><a href="#cb108-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(turtles.svd<span class="sc">$</span>u)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 48  3</code></pre>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb110"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb110-1"><a href="#cb110-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(turtles.svd<span class="sc">$</span>v[,<span class="dv">1</span>]<span class="sc">^</span><span class="dv">2</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb112"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb112-1"><a href="#cb112-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(turtles.svd<span class="sc">$</span>d<span class="sc">^</span><span class="dv">2</span>) <span class="sc">/</span> <span class="dv">47</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 3</code></pre>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb114"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb114-1"><a href="#cb114-1" aria-hidden="true" tabindex="-1"></a><span class="fu">stopifnot</span>(<span class="fu">max</span>(<span class="fu">abs</span>(turtles.svd<span class="sc">$</span>v[,<span class="dv">1</span>]<span class="sc">^</span><span class="dv">2</span> <span class="sc">-</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">3</span>)) <span class="sc">&lt;</span> <span class="fl">0.01</span>)</span>
<span id="cb114-2"><a href="#cb114-2" aria-hidden="true" tabindex="-1"></a>US <span class="ot">=</span> turtles.svd<span class="sc">$</span>u[,<span class="dv">1</span>, drop <span class="ot">=</span> <span class="cn">FALSE</span>] <span class="sc">%*%</span> turtles.svd<span class="sc">$</span>d[<span class="dv">1</span>]</span>
<span id="cb114-3"><a href="#cb114-3" aria-hidden="true" tabindex="-1"></a>XV <span class="ot">=</span> scaledTurtles <span class="sc">%*%</span> turtles.svd<span class="sc">$</span>v[, <span class="dv">1</span>, drop <span class="ot">=</span> <span class="cn">FALSE</span>]</span>
<span id="cb114-4"><a href="#cb114-4" aria-hidden="true" tabindex="-1"></a><span class="fu">max</span>(<span class="fu">abs</span>(US<span class="sc">-</span>XV))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 2.88658e-15</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb116"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb116-1"><a href="#cb116-1" aria-hidden="true" tabindex="-1"></a><span class="fu">stopifnot</span>(<span class="fu">max</span>(<span class="fu">abs</span>(US<span class="sc">-</span>XV)) <span class="sc">&lt;</span> <span class="fl">1e-9</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb117"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb117-1"><a href="#cb117-1" aria-hidden="true" tabindex="-1"></a>svda<span class="sc">$</span>v[,<span class="dv">1</span>]</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] -0.7071068 -0.7071068</code></pre>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb119"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb119-1"><a href="#cb119-1" aria-hidden="true" tabindex="-1"></a>ppdf <span class="ot">=</span> tibble<span class="sc">::</span><span class="fu">tibble</span>(<span class="at">PC1n =</span> <span class="sc">-</span>svda<span class="sc">$</span>u[, <span class="dv">1</span>] <span class="sc">*</span> svda<span class="sc">$</span>d[<span class="dv">1</span>],</span>
<span id="cb119-2"><a href="#cb119-2" aria-hidden="true" tabindex="-1"></a>              <span class="at">PC2n =</span>  svda<span class="sc">$</span>u[, <span class="dv">2</span>] <span class="sc">*</span> svda<span class="sc">$</span>d[<span class="dv">2</span>])</span>
<span id="cb119-3"><a href="#cb119-3" aria-hidden="true" tabindex="-1"></a>gg <span class="ot">=</span> <span class="fu">ggplot</span>(ppdf, <span class="fu">aes</span>(<span class="at">x =</span> PC1n, <span class="at">y =</span> PC2n)) <span class="sc">+</span> </span>
<span id="cb119-4"><a href="#cb119-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>() <span class="sc">+</span> </span>
<span id="cb119-5"><a href="#cb119-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>, <span class="at">color =</span> <span class="st">"purple"</span>, <span class="at">linewidth =</span> <span class="fl">1.5</span>, <span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb119-6"><a href="#cb119-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">xlab</span>(<span class="st">"PC1 "</span>)<span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">"PC2"</span>) <span class="sc">+</span> <span class="fu">xlim</span>(<span class="sc">-</span><span class="fl">3.5</span>, <span class="fl">2.7</span>) <span class="sc">+</span> <span class="fu">ylim</span>(<span class="sc">-</span><span class="dv">2</span>, <span class="dv">2</span>) <span class="sc">+</span> <span class="fu">coord_fixed</span>()</span>
<span id="cb119-7"><a href="#cb119-7" aria-hidden="true" tabindex="-1"></a>gg <span class="sc">+</span> <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x =</span> PC1n, <span class="at">y =</span> <span class="dv">0</span>), <span class="at">color =</span> <span class="st">"red"</span>) <span class="sc">+</span></span>
<span id="cb119-8"><a href="#cb119-8" aria-hidden="true" tabindex="-1"></a>     <span class="fu">geom_segment</span>(<span class="fu">aes</span>(<span class="at">xend =</span> PC1n, <span class="at">yend =</span> <span class="dv">0</span>), <span class="at">color =</span> <span class="st">"red"</span>) </span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="07-chap_files/figure-html/unnamed-chunk-23-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb120"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb120-1"><a href="#cb120-1" aria-hidden="true" tabindex="-1"></a>gg <span class="sc">+</span> <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="dv">0</span>, <span class="at">y =</span> PC2n), <span class="at">color =</span> <span class="st">"blue"</span>) <span class="sc">+</span></span>
<span id="cb120-2"><a href="#cb120-2" aria-hidden="true" tabindex="-1"></a>     <span class="fu">geom_segment</span>(<span class="fu">aes</span>(<span class="at">yend =</span> PC2n, <span class="at">xend =</span> <span class="dv">0</span>), <span class="at">color =</span> <span class="st">"blue"</span>) <span class="sc">+</span></span>
<span id="cb120-3"><a href="#cb120-3" aria-hidden="true" tabindex="-1"></a>     <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">0</span>, <span class="at">color =</span> <span class="st">"skyblue"</span>, <span class="at">linewidth =</span> <span class="fl">1.5</span>, <span class="at">alpha =</span> <span class="fl">0.5</span>) </span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="07-chap_files/figure-html/unnamed-chunk-23-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb121"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb121-1"><a href="#cb121-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(ppdf<span class="sc">$</span>PC2n<span class="sc">^</span><span class="dv">2</span>) </span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 6.196729</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb123"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb123-1"><a href="#cb123-1" aria-hidden="true" tabindex="-1"></a>svda<span class="sc">$</span>d[<span class="dv">2</span>]<span class="sc">^</span><span class="dv">2</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 6.196729</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb125"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb125-1"><a href="#cb125-1" aria-hidden="true" tabindex="-1"></a><span class="fu">stopifnot</span>(<span class="fu">abs</span>(<span class="fu">sum</span>(ppdf<span class="sc">$</span>PC2n<span class="sc">^</span><span class="dv">2</span>) <span class="sc">-</span> svda<span class="sc">$</span>d[<span class="dv">2</span>]<span class="sc">^</span><span class="dv">2</span>)<span class="sc">&lt;</span><span class="fl">1e-9</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb126"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb126-1"><a href="#cb126-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(ppdf<span class="sc">$</span>PC2n) </span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 5.735068e-16</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb128"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb128-1"><a href="#cb128-1" aria-hidden="true" tabindex="-1"></a><span class="fu">var</span>(ppdf<span class="sc">$</span>PC2n) <span class="sc">*</span> (<span class="fu">nrow</span>(ppdf)<span class="sc">-</span><span class="dv">1</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 6.196729</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb130"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb130-1"><a href="#cb130-1" aria-hidden="true" tabindex="-1"></a><span class="fu">stopifnot</span>(<span class="fu">abs</span>(<span class="fu">var</span>(ppdf<span class="sc">$</span>PC2n) <span class="sc">*</span> (<span class="fu">nrow</span>(ppdf)<span class="sc">-</span><span class="dv">1</span>) <span class="sc">-</span> svda<span class="sc">$</span>d[<span class="dv">2</span>]<span class="sc">^</span><span class="dv">2</span>) <span class="sc">&lt;</span> <span class="fl">1e-9</span>, <span class="fu">abs</span>(<span class="fu">mean</span>(ppdf<span class="sc">$</span>PC2n)) <span class="sc">&lt;</span> <span class="fl">1e-9</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb131"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb131-1"><a href="#cb131-1" aria-hidden="true" tabindex="-1"></a><span class="fu">var</span>(ppdf<span class="sc">$</span>PC1n) </span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1.806352</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb133"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb133-1"><a href="#cb133-1" aria-hidden="true" tabindex="-1"></a><span class="fu">var</span>(ppdf<span class="sc">$</span>PC2n) </span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.1936478</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb135"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb135-1"><a href="#cb135-1" aria-hidden="true" tabindex="-1"></a><span class="fu">stopifnot</span>(<span class="fu">var</span>(ppdf<span class="sc">$</span>PC1n) <span class="sc">&gt;</span> <span class="fu">var</span>(ppdf<span class="sc">$</span>PC2n))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb136"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb136-1"><a href="#cb136-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sd</span>(ppdf<span class="sc">$</span>PC1n) <span class="sc">/</span> <span class="fu">sd</span>(ppdf<span class="sc">$</span>PC2n)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 3.054182</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb138"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb138-1"><a href="#cb138-1" aria-hidden="true" tabindex="-1"></a>svda<span class="sc">$</span>d[<span class="dv">1</span>] <span class="sc">/</span> svda<span class="sc">$</span>d[<span class="dv">2</span>]</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 3.054182</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb140"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb140-1"><a href="#cb140-1" aria-hidden="true" tabindex="-1"></a><span class="fu">stopifnot</span>(<span class="fu">sd</span>(ppdf<span class="sc">$</span>PC1n) <span class="sc">/</span> <span class="fu">sd</span>(ppdf<span class="sc">$</span>PC2n) <span class="sc">-</span> svda<span class="sc">$</span>d[<span class="dv">1</span>] <span class="sc">/</span> svda<span class="sc">$</span>d[<span class="dv">2</span>] <span class="sc">&lt;</span> <span class="fl">1e-9</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb141"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb141-1"><a href="#cb141-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cor</span>(scaledTurtles)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>          length     width    height
length 1.0000000 0.9783116 0.9646946
width  0.9783116 1.0000000 0.9605705
height 0.9646946 0.9605705 1.0000000</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb143"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb143-1"><a href="#cb143-1" aria-hidden="true" tabindex="-1"></a>pcaturtles <span class="ot">=</span> <span class="fu">princomp</span>(scaledTurtles)</span>
<span id="cb143-2"><a href="#cb143-2" aria-hidden="true" tabindex="-1"></a>pcaturtles</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Call:
princomp(x = scaledTurtles)

Standard deviations:
   Comp.1    Comp.2    Comp.3 
1.6954576 0.2048201 0.1448180 

 3  variables and  48 observations.</code></pre>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb145"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb145-1"><a href="#cb145-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">"factoextra"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stderr">
<pre><code>Welcome! Want to learn more? See two factoextra-related books at https://goo.gl/ve3WBa</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb147"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb147-1"><a href="#cb147-1" aria-hidden="true" tabindex="-1"></a><span class="fu">fviz_eig</span>(pcaturtles, <span class="at">geom =</span> <span class="st">"bar"</span>, <span class="at">bar_width =</span> <span class="fl">0.4</span>) <span class="sc">+</span> <span class="fu">ggtitle</span>(<span class="st">""</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="07-chap_files/figure-html/unnamed-chunk-29-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb148"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb148-1"><a href="#cb148-1" aria-hidden="true" tabindex="-1"></a><span class="fu">svd</span>(scaledTurtles)<span class="sc">$</span>v[, <span class="dv">1</span>]</span>
<span id="cb148-2"><a href="#cb148-2" aria-hidden="true" tabindex="-1"></a><span class="fu">prcomp</span>(turtles[, <span class="sc">-</span><span class="dv">1</span>])<span class="sc">$</span>rotation[, <span class="dv">1</span>]</span>
<span id="cb148-3"><a href="#cb148-3" aria-hidden="true" tabindex="-1"></a><span class="fu">princomp</span>(scaledTurtles)<span class="sc">$</span>loadings[, <span class="dv">1</span>]</span>
<span id="cb148-4"><a href="#cb148-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">"ade4"</span>)</span>
<span id="cb148-5"><a href="#cb148-5" aria-hidden="true" tabindex="-1"></a><span class="fu">dudi.pca</span>(turtles[, <span class="sc">-</span><span class="dv">1</span>], <span class="at">nf =</span> <span class="dv">2</span>, <span class="at">scannf =</span> <span class="cn">FALSE</span>)<span class="sc">$</span>c1[, <span class="dv">1</span>]</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb149"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb149-1"><a href="#cb149-1" aria-hidden="true" tabindex="-1"></a>res <span class="ot">=</span> <span class="fu">princomp</span>(scaledTurtles)</span>
<span id="cb149-2"><a href="#cb149-2" aria-hidden="true" tabindex="-1"></a>PC1 <span class="ot">=</span> scaledTurtles <span class="sc">%*%</span> res<span class="sc">$</span>loadings[,<span class="dv">1</span>]</span>
<span id="cb149-3"><a href="#cb149-3" aria-hidden="true" tabindex="-1"></a>sd1 <span class="ot">=</span> <span class="fu">sqrt</span>(<span class="fu">mean</span>(res<span class="sc">$</span>scores[, <span class="dv">1</span>]<span class="sc">^</span><span class="dv">2</span>))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb150"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb150-1"><a href="#cb150-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">"ade4"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'ade4'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following object is masked from 'package:GenomicRanges':

    score</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following object is masked from 'package:BiocGenerics':

    score</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb154"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb154-1"><a href="#cb154-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">"tibble"</span>)</span>
<span id="cb154-2"><a href="#cb154-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb154-3"><a href="#cb154-3" aria-hidden="true" tabindex="-1"></a><span class="fu">fviz_pca_biplot</span>(pcaturtles, <span class="at">label =</span> <span class="st">"var"</span>, <span class="at">habillage =</span> turtles[, <span class="dv">1</span>]) <span class="sc">+</span></span>
<span id="cb154-4"><a href="#cb154-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">""</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Using `size` aesthetic for lines was deprecated in ggplot2 3.4.0.
ℹ Please use `linewidth` instead.
ℹ The deprecated feature was likely used in the ggpubr package.
  Please report the issue at &lt;https://github.com/kassambara/ggpubr/issues&gt;.</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="07-chap_files/figure-html/unnamed-chunk-32-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb156"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb156-1"><a href="#cb156-1" aria-hidden="true" tabindex="-1"></a>pcadudit <span class="ot">=</span> <span class="fu">dudi.pca</span>(scaledTurtles, <span class="at">nf =</span> <span class="dv">2</span>, <span class="at">scannf =</span> <span class="cn">FALSE</span>)</span>
<span id="cb156-2"><a href="#cb156-2" aria-hidden="true" tabindex="-1"></a><span class="fu">apply</span>(pcadudit<span class="sc">$</span>li, <span class="dv">2</span>, <span class="cf">function</span>(x) <span class="fu">sum</span>(x<span class="sc">^</span><span class="dv">2</span>)<span class="sc">/</span><span class="dv">48</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>     Axis1      Axis2 
2.93573765 0.04284387 </code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb158"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb158-1"><a href="#cb158-1" aria-hidden="true" tabindex="-1"></a>pcadudit<span class="sc">$</span>eig</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 2.93573765 0.04284387 0.02141848</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb160"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb160-1"><a href="#cb160-1" aria-hidden="true" tabindex="-1"></a><span class="fu">fviz_pca_var</span>(pcaturtles, <span class="at">col.circle =</span> <span class="st">"black"</span>) <span class="sc">+</span> <span class="fu">ggtitle</span>(<span class="st">""</span>) <span class="sc">+</span></span>
<span id="cb160-2"><a href="#cb160-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlim</span>(<span class="fu">c</span>(<span class="sc">-</span><span class="fl">1.2</span>, <span class="fl">1.2</span>)) <span class="sc">+</span> <span class="fu">ylim</span>(<span class="fu">c</span>(<span class="sc">-</span><span class="fl">1.2</span>, <span class="fl">1.2</span>))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="07-chap_files/figure-html/unnamed-chunk-32-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb161"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb161-1"><a href="#cb161-1" aria-hidden="true" tabindex="-1"></a><span class="fu">svd</span>(scaledTurtles)<span class="sc">$</span>d<span class="sc">/</span>pcaturtles<span class="sc">$</span>sdev</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>  Comp.1   Comp.2   Comp.3 
6.928203 6.928203 6.928203 </code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb163"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb163-1"><a href="#cb163-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sqrt</span>(<span class="dv">47</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 6.855655</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb165"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb165-1"><a href="#cb165-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cor</span>(athletes) <span class="sc">|&gt;</span> <span class="fu">round</span>(<span class="dv">1</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>       m100 long weight highj m400 m110 disc pole javel m1500
m100    1.0 -0.5   -0.2  -0.1  0.6  0.6  0.0 -0.4  -0.1   0.3
long   -0.5  1.0    0.1   0.3 -0.5 -0.5  0.0  0.3   0.2  -0.4
weight -0.2  0.1    1.0   0.1  0.1 -0.3  0.8  0.5   0.6   0.3
highj  -0.1  0.3    0.1   1.0 -0.1 -0.3  0.1  0.2   0.1  -0.1
m400    0.6 -0.5    0.1  -0.1  1.0  0.5  0.1 -0.3   0.1   0.6
m110    0.6 -0.5   -0.3  -0.3  0.5  1.0 -0.1 -0.5  -0.1   0.1
disc    0.0  0.0    0.8   0.1  0.1 -0.1  1.0  0.3   0.4   0.4
pole   -0.4  0.3    0.5   0.2 -0.3 -0.5  0.3  1.0   0.3   0.0
javel  -0.1  0.2    0.6   0.1  0.1 -0.1  0.4  0.3   1.0   0.1
m1500   0.3 -0.4    0.3  -0.1  0.6  0.1  0.4  0.0   0.1   1.0</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb167"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb167-1"><a href="#cb167-1" aria-hidden="true" tabindex="-1"></a>pca.ath <span class="ot">=</span> <span class="fu">dudi.pca</span>(athletes, <span class="at">scannf =</span> <span class="cn">FALSE</span>)</span>
<span id="cb167-2"><a href="#cb167-2" aria-hidden="true" tabindex="-1"></a>pca.ath<span class="sc">$</span>eig</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] 3.4182381 2.6063931 0.9432964 0.8780212 0.5566267 0.4912275 0.4305952
 [8] 0.3067981 0.2669494 0.1018542</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb169"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb169-1"><a href="#cb169-1" aria-hidden="true" tabindex="-1"></a><span class="fu">fviz_eig</span>(pca.ath, <span class="at">geom =</span> <span class="st">"bar"</span>, <span class="at">bar_width =</span> <span class="fl">0.3</span>) <span class="sc">+</span> <span class="fu">ggtitle</span>(<span class="st">""</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="07-chap_files/figure-html/unnamed-chunk-32-3.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb170"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb170-1"><a href="#cb170-1" aria-hidden="true" tabindex="-1"></a><span class="fu">fviz_pca_var</span>(pca.ath, <span class="at">col.circle =</span> <span class="st">"black"</span>) <span class="sc">+</span> <span class="fu">ggtitle</span>(<span class="st">""</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: `aes_string()` was deprecated in ggplot2 3.0.0.
ℹ Please use tidy evaluation idioms with `aes()`.
ℹ See also `vignette("ggplot2-in-packages")` for more information.
ℹ The deprecated feature was likely used in the factoextra package.
  Please report the issue at &lt;https://github.com/kassambara/factoextra/issues&gt;.</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="07-chap_files/figure-html/unnamed-chunk-32-4.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb172"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb172-1"><a href="#cb172-1" aria-hidden="true" tabindex="-1"></a>athletes[, <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">5</span>, <span class="dv">6</span>, <span class="dv">10</span>)] <span class="ot">=</span> <span class="sc">-</span>athletes[, <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">5</span>, <span class="dv">6</span>, <span class="dv">10</span>)]</span>
<span id="cb172-2"><a href="#cb172-2" aria-hidden="true" tabindex="-1"></a><span class="fu">cor</span>(athletes) <span class="sc">|&gt;</span> <span class="fu">round</span>(<span class="dv">1</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>       m100 long weight highj m400 m110 disc pole javel m1500
m100    1.0  0.5    0.2   0.1  0.6  0.6  0.0  0.4   0.1   0.3
long    0.5  1.0    0.1   0.3  0.5  0.5  0.0  0.3   0.2   0.4
weight  0.2  0.1    1.0   0.1 -0.1  0.3  0.8  0.5   0.6  -0.3
highj   0.1  0.3    0.1   1.0  0.1  0.3  0.1  0.2   0.1   0.1
m400    0.6  0.5   -0.1   0.1  1.0  0.5 -0.1  0.3  -0.1   0.6
m110    0.6  0.5    0.3   0.3  0.5  1.0  0.1  0.5   0.1   0.1
disc    0.0  0.0    0.8   0.1 -0.1  0.1  1.0  0.3   0.4  -0.4
pole    0.4  0.3    0.5   0.2  0.3  0.5  0.3  1.0   0.3   0.0
javel   0.1  0.2    0.6   0.1 -0.1  0.1  0.4  0.3   1.0  -0.1
m1500   0.3  0.4   -0.3   0.1  0.6  0.1 -0.4  0.0  -0.1   1.0</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb174"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb174-1"><a href="#cb174-1" aria-hidden="true" tabindex="-1"></a>pcan.ath <span class="ot">=</span> <span class="fu">dudi.pca</span>(athletes, <span class="at">nf =</span> <span class="dv">2</span>, <span class="at">scannf =</span> <span class="cn">FALSE</span>)</span>
<span id="cb174-2"><a href="#cb174-2" aria-hidden="true" tabindex="-1"></a>pcan.ath<span class="sc">$</span>eig</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] 3.4182381 2.6063931 0.9432964 0.8780212 0.5566267 0.4912275 0.4305952
 [8] 0.3067981 0.2669494 0.1018542</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb176"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb176-1"><a href="#cb176-1" aria-hidden="true" tabindex="-1"></a><span class="fu">fviz_pca_var</span>(pcan.ath, <span class="at">col.circle=</span><span class="st">"black"</span>) <span class="sc">+</span> <span class="fu">ggtitle</span>(<span class="st">""</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="07-chap_files/figure-html/unnamed-chunk-32-5.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb177"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb177-1"><a href="#cb177-1" aria-hidden="true" tabindex="-1"></a><span class="fu">fviz_pca_ind</span>(pcan.ath) <span class="sc">+</span> <span class="fu">ggtitle</span>(<span class="st">""</span>) <span class="sc">+</span> <span class="fu">ylim</span>(<span class="fu">c</span>(<span class="sc">-</span><span class="fl">2.5</span>,<span class="fl">5.7</span>))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="07-chap_files/figure-html/unnamed-chunk-32-6.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb178"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb178-1"><a href="#cb178-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">"olympic"</span>, <span class="at">package =</span> <span class="st">"ade4"</span>)</span>
<span id="cb178-2"><a href="#cb178-2" aria-hidden="true" tabindex="-1"></a>olympic<span class="sc">$</span>score</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] 8488 8399 8328 8306 8286 8272 8216 8189 8180 8167 8143 8114 8093 8083 8036
[16] 8021 7869 7860 7859 7781 7753 7745 7743 7623 7579 7517 7505 7422 7310 7237
[31] 7231 7016 6907</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb180"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb180-1"><a href="#cb180-1" aria-hidden="true" tabindex="-1"></a>p <span class="ot">=</span> <span class="fu">ggplot</span>(<span class="fu">tibble</span>(<span class="at">pc1 =</span> pcan.ath<span class="sc">$</span>li[, <span class="dv">1</span>], <span class="at">score =</span> olympic<span class="sc">$</span>score, <span class="at">id =</span> <span class="fu">rownames</span>(athletes)),</span>
<span id="cb180-2"><a href="#cb180-2" aria-hidden="true" tabindex="-1"></a>   <span class="fu">aes</span>(<span class="at">x =</span> score, <span class="at">y =</span> pc1, <span class="at">label =</span> id)) <span class="sc">+</span> <span class="fu">geom_text</span>()</span>
<span id="cb180-3"><a href="#cb180-3" aria-hidden="true" tabindex="-1"></a>p <span class="sc">+</span> <span class="fu">stat_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">se =</span> <span class="cn">FALSE</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stderr">
<pre><code>`geom_smooth()` using formula = 'y ~ x'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: The following aesthetics were dropped during statistical transformation: label.
ℹ This can happen when ggplot fails to infer the correct grouping structure in
  the data.
ℹ Did you forget to specify a `group` aesthetic or to convert a numerical
  variable into a factor?</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="07-chap_files/figure-html/unnamed-chunk-32-7.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb183"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb183-1"><a href="#cb183-1" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(<span class="st">"../data/screep7.RData"</span>)</span>
<span id="cb183-2"><a href="#cb183-2" aria-hidden="true" tabindex="-1"></a>pcaS7 <span class="ot">=</span> <span class="fu">dudi.pca</span>(screep7, <span class="at">scannf =</span> <span class="cn">FALSE</span>)</span>
<span id="cb183-3"><a href="#cb183-3" aria-hidden="true" tabindex="-1"></a><span class="fu">fviz_eig</span>(pcaS7,<span class="at">geom=</span><span class="st">"bar"</span>,<span class="at">bar_width=</span><span class="fl">0.5</span>) <span class="sc">+</span> <span class="fu">ggtitle</span>(<span class="st">""</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="07-chap_files/figure-html/unnamed-chunk-32-8.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb184"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb184-1"><a href="#cb184-1" aria-hidden="true" tabindex="-1"></a><span class="co">#problem with dudi and prcomp eigenvalues</span></span>
<span id="cb184-2"><a href="#cb184-2" aria-hidden="true" tabindex="-1"></a><span class="co">#prcomp does not scale by default, dudi.pca does</span></span>
<span id="cb184-3"><a href="#cb184-3" aria-hidden="true" tabindex="-1"></a><span class="co">#fviz_eig(pcaS7,geom="bar",width=0.3)</span></span>
<span id="cb184-4"><a href="#cb184-4" aria-hidden="true" tabindex="-1"></a><span class="co">#p7=prcomp(screep7,scale= TRUE)</span></span>
<span id="cb184-5"><a href="#cb184-5" aria-hidden="true" tabindex="-1"></a><span class="co">#p7$sdev^2</span></span>
<span id="cb184-6"><a href="#cb184-6" aria-hidden="true" tabindex="-1"></a><span class="co">#plot(p7)</span></span>
<span id="cb184-7"><a href="#cb184-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb184-8"><a href="#cb184-8" aria-hidden="true" tabindex="-1"></a>pcaMsig3 <span class="ot">=</span> <span class="fu">dudi.pca</span>(Msig3transp, <span class="at">center =</span> <span class="cn">TRUE</span>, <span class="at">scale =</span> <span class="cn">TRUE</span>,</span>
<span id="cb184-9"><a href="#cb184-9" aria-hidden="true" tabindex="-1"></a>                    <span class="at">scannf =</span> <span class="cn">FALSE</span>, <span class="at">nf =</span> <span class="dv">4</span>)</span>
<span id="cb184-10"><a href="#cb184-10" aria-hidden="true" tabindex="-1"></a><span class="fu">fviz_screeplot</span>(pcaMsig3) <span class="sc">+</span> <span class="fu">ggtitle</span>(<span class="st">""</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in geom_bar(stat = "identity", fill = barfill, color = barcolor, :
Ignoring empty aesthetic: `width`.</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="07-chap_files/figure-html/unnamed-chunk-32-9.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb186"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb186-1"><a href="#cb186-1" aria-hidden="true" tabindex="-1"></a>ids <span class="ot">=</span> <span class="fu">rownames</span>(Msig3transp)</span>
<span id="cb186-2"><a href="#cb186-2" aria-hidden="true" tabindex="-1"></a>celltypes <span class="ot">=</span> <span class="fu">factor</span>(<span class="fu">substr</span>(ids, <span class="dv">7</span>, <span class="dv">9</span>))</span>
<span id="cb186-3"><a href="#cb186-3" aria-hidden="true" tabindex="-1"></a>status <span class="ot">=</span> <span class="fu">factor</span>(<span class="fu">substr</span>(ids, <span class="dv">1</span>, <span class="dv">3</span>))</span>
<span id="cb186-4"><a href="#cb186-4" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(celltypes)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>celltypes
EFF MEM NAI 
 10   9  11 </code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb188"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb188-1"><a href="#cb188-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cbind</span>(pcaMsig3<span class="sc">$</span>li, <span class="fu">tibble</span>(<span class="at">Cluster =</span> celltypes, <span class="at">sample =</span> ids)) <span class="sc">|&gt;</span></span>
<span id="cb188-2"><a href="#cb188-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> Axis1, <span class="at">y =</span> Axis2)) <span class="sc">+</span></span>
<span id="cb188-3"><a href="#cb188-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">color =</span> Cluster), <span class="at">size =</span> <span class="dv">5</span>) <span class="sc">+</span></span>
<span id="cb188-4"><a href="#cb188-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>, <span class="at">linetype =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb188-5"><a href="#cb188-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">0</span>, <span class="at">linetype =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb188-6"><a href="#cb188-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_discrete</span>(<span class="at">name =</span> <span class="st">"Cluster"</span>) <span class="sc">+</span> <span class="fu">coord_fixed</span>()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="07-chap_files/figure-html/unnamed-chunk-32-10.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb189"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb189-1"><a href="#cb189-1" aria-hidden="true" tabindex="-1"></a><span class="do">## # For the record:</span></span>
<span id="cb189-2"><a href="#cb189-2" aria-hidden="true" tabindex="-1"></a><span class="do">## library("xcms")</span></span>
<span id="cb189-3"><a href="#cb189-3" aria-hidden="true" tabindex="-1"></a><span class="do">## cdfpath = system.file("cdf", package = "faahKO")</span></span>
<span id="cb189-4"><a href="#cb189-4" aria-hidden="true" tabindex="-1"></a><span class="do">## cdffiles = list.files(cdfpath, recursive = TRUE, full = TRUE)</span></span>
<span id="cb189-5"><a href="#cb189-5" aria-hidden="true" tabindex="-1"></a><span class="do">## xset = xcmsSet(cdffiles)</span></span>
<span id="cb189-6"><a href="#cb189-6" aria-hidden="true" tabindex="-1"></a><span class="do">## xset2 = group(xset)</span></span>
<span id="cb189-7"><a href="#cb189-7" aria-hidden="true" tabindex="-1"></a><span class="do">## xset2 = retcor(xset2)</span></span>
<span id="cb189-8"><a href="#cb189-8" aria-hidden="true" tabindex="-1"></a><span class="do">## xset2 = group(xset2, bw = 10)</span></span>
<span id="cb189-9"><a href="#cb189-9" aria-hidden="true" tabindex="-1"></a><span class="do">## xset3 = fillPeaks(xset2)</span></span>
<span id="cb189-10"><a href="#cb189-10" aria-hidden="true" tabindex="-1"></a><span class="do">## gt = groups(xset3)</span></span>
<span id="cb189-11"><a href="#cb189-11" aria-hidden="true" tabindex="-1"></a><span class="do">## mat1 = groupval(xset3, value = "into")</span></span>
<span id="cb189-12"><a href="#cb189-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb189-13"><a href="#cb189-13" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(<span class="st">"../data/mat1xcms.RData"</span>)</span>
<span id="cb189-14"><a href="#cb189-14" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(mat1)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 399  12</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb191"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb191-1"><a href="#cb191-1" aria-hidden="true" tabindex="-1"></a>pcamat1 <span class="ot">=</span> <span class="fu">dudi.pca</span>(<span class="fu">t</span>(mat1), <span class="at">scannf =</span> <span class="cn">FALSE</span>, <span class="at">nf =</span> <span class="dv">3</span>)</span>
<span id="cb191-2"><a href="#cb191-2" aria-hidden="true" tabindex="-1"></a><span class="fu">fviz_eig</span>(pcamat1, <span class="at">geom =</span> <span class="st">"bar"</span>, <span class="at">bar_width =</span> <span class="fl">0.7</span>) <span class="sc">+</span> <span class="fu">ggtitle</span>(<span class="st">""</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="07-chap_files/figure-html/unnamed-chunk-32-11.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb192"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb192-1"><a href="#cb192-1" aria-hidden="true" tabindex="-1"></a>dfmat1 <span class="ot">=</span> <span class="fu">cbind</span>(pcamat1<span class="sc">$</span>li, <span class="fu">tibble</span>(</span>
<span id="cb192-2"><a href="#cb192-2" aria-hidden="true" tabindex="-1"></a>    <span class="at">label =</span> <span class="fu">rownames</span>(pcamat1<span class="sc">$</span>li),</span>
<span id="cb192-3"><a href="#cb192-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">number =</span> <span class="fu">substr</span>(label, <span class="dv">3</span>, <span class="dv">4</span>),</span>
<span id="cb192-4"><a href="#cb192-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">type =</span> <span class="fu">factor</span>(<span class="fu">substr</span>(label, <span class="dv">1</span>, <span class="dv">2</span>))))</span>
<span id="cb192-5"><a href="#cb192-5" aria-hidden="true" tabindex="-1"></a>pcsplot <span class="ot">=</span> <span class="fu">ggplot</span>(dfmat1,</span>
<span id="cb192-6"><a href="#cb192-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes</span>(<span class="at">x=</span>Axis1, <span class="at">y=</span>Axis2, <span class="at">label=</span>label, <span class="at">group=</span>number, <span class="at">colour=</span>type)) <span class="sc">+</span></span>
<span id="cb192-7"><a href="#cb192-7" aria-hidden="true" tabindex="-1"></a> <span class="fu">geom_text</span>(<span class="at">size =</span> <span class="dv">4</span>, <span class="at">vjust =</span> <span class="sc">-</span><span class="fl">0.5</span>)<span class="sc">+</span> <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">3</span>)<span class="sc">+</span><span class="fu">ylim</span>(<span class="fu">c</span>(<span class="sc">-</span><span class="dv">18</span>,<span class="dv">19</span>))</span>
<span id="cb192-8"><a href="#cb192-8" aria-hidden="true" tabindex="-1"></a>pcsplot <span class="sc">+</span> <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>, <span class="at">linetype =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb192-9"><a href="#cb192-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">0</span>, <span class="at">linetype =</span> <span class="dv">2</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="07-chap_files/figure-html/unnamed-chunk-32-12.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb193"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb193-1"><a href="#cb193-1" aria-hidden="true" tabindex="-1"></a>pcsplot <span class="sc">+</span> <span class="fu">geom_line</span>(<span class="at">colour =</span> <span class="st">"red"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="07-chap_files/figure-html/unnamed-chunk-32-13.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb194"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb194-1"><a href="#cb194-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">"pheatmap"</span>)</span>
<span id="cb194-2"><a href="#cb194-2" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(<span class="st">"../data/wine.RData"</span>)</span>
<span id="cb194-3"><a href="#cb194-3" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(<span class="st">"../data/wineClass.RData"</span>)</span>
<span id="cb194-4"><a href="#cb194-4" aria-hidden="true" tabindex="-1"></a>wine[<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">7</span>]</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>  Alcohol MalicAcid  Ash AlcAsh  Mg Phenols Flav
1   14.23      1.71 2.43   15.6 127    2.80 3.06
2   13.20      1.78 2.14   11.2 100    2.65 2.76</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb196"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb196-1"><a href="#cb196-1" aria-hidden="true" tabindex="-1"></a><span class="fu">pheatmap</span>(<span class="dv">1</span> <span class="sc">-</span> <span class="fu">cor</span>(wine), <span class="at">treeheight_row =</span> <span class="fl">0.2</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="07-chap_files/figure-html/unnamed-chunk-32-14.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb197"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb197-1"><a href="#cb197-1" aria-hidden="true" tabindex="-1"></a>winePCAd <span class="ot">=</span> <span class="fu">dudi.pca</span>(wine, <span class="at">scannf=</span><span class="cn">FALSE</span>)</span>
<span id="cb197-2"><a href="#cb197-2" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(wine.class)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>wine.class
    barolo grignolino    barbera 
        59         71         48 </code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb199"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb199-1"><a href="#cb199-1" aria-hidden="true" tabindex="-1"></a><span class="fu">fviz_pca_biplot</span>(winePCAd, <span class="at">geom =</span> <span class="st">"point"</span>, <span class="at">habillage =</span> wine.class,</span>
<span id="cb199-2"><a href="#cb199-2" aria-hidden="true" tabindex="-1"></a>   <span class="at">col.var =</span> <span class="st">"violet"</span>, <span class="at">addEllipses =</span> <span class="cn">TRUE</span>, <span class="at">ellipse.level =</span> <span class="fl">0.69</span>) <span class="sc">+</span></span>
<span id="cb199-3"><a href="#cb199-3" aria-hidden="true" tabindex="-1"></a>   <span class="fu">ggtitle</span>(<span class="st">""</span>) <span class="sc">+</span> <span class="fu">coord_fixed</span>()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="07-chap_files/figure-html/unnamed-chunk-32-15.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb200"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb200-1"><a href="#cb200-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">"x"</span>, <span class="at">package =</span> <span class="st">"Hiiragi2013"</span>)</span>
<span id="cb200-2"><a href="#cb200-2" aria-hidden="true" tabindex="-1"></a>xwt <span class="ot">=</span> x[, x<span class="sc">$</span>genotype <span class="sc">==</span> <span class="st">"WT"</span>]</span>
<span id="cb200-3"><a href="#cb200-3" aria-hidden="true" tabindex="-1"></a>sel <span class="ot">=</span> <span class="fu">order</span>(<span class="fu">rowVars</span>(Biobase<span class="sc">::</span><span class="fu">exprs</span>(xwt)), <span class="at">decreasing =</span> <span class="cn">TRUE</span>)[<span class="dv">1</span><span class="sc">:</span><span class="dv">100</span>]</span>
<span id="cb200-4"><a href="#cb200-4" aria-hidden="true" tabindex="-1"></a>xwt <span class="ot">=</span> xwt[sel, ]</span>
<span id="cb200-5"><a href="#cb200-5" aria-hidden="true" tabindex="-1"></a>tab <span class="ot">=</span> <span class="fu">table</span>(xwt<span class="sc">$</span>sampleGroup)</span>
<span id="cb200-6"><a href="#cb200-6" aria-hidden="true" tabindex="-1"></a>tab</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>
     E3.25 E3.5 (EPI)  E3.5 (PE) E4.5 (EPI)  E4.5 (PE) 
        36         11         11          4          4 </code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb202"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb202-1"><a href="#cb202-1" aria-hidden="true" tabindex="-1"></a>xwt<span class="sc">$</span>weight <span class="ot">=</span> <span class="dv">1</span> <span class="sc">/</span> <span class="fu">as.numeric</span>(tab[xwt<span class="sc">$</span>sampleGroup])</span>
<span id="cb202-2"><a href="#cb202-2" aria-hidden="true" tabindex="-1"></a>pcaMouse <span class="ot">=</span> <span class="fu">dudi.pca</span>(<span class="fu">as.data.frame</span>(<span class="fu">t</span>(Biobase<span class="sc">::</span><span class="fu">exprs</span>(xwt))),</span>
<span id="cb202-3"><a href="#cb202-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">row.w =</span> xwt<span class="sc">$</span>weight,</span>
<span id="cb202-4"><a href="#cb202-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">center =</span> <span class="cn">TRUE</span>, <span class="at">scale =</span> <span class="cn">TRUE</span>, <span class="at">nf =</span> <span class="dv">2</span>, <span class="at">scannf =</span> <span class="cn">FALSE</span>)</span>
<span id="cb202-5"><a href="#cb202-5" aria-hidden="true" tabindex="-1"></a><span class="fu">fviz_eig</span>(pcaMouse) <span class="sc">+</span> <span class="fu">ggtitle</span>(<span class="st">""</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in geom_bar(stat = "identity", fill = barfill, color = barcolor, :
Ignoring empty aesthetic: `width`.</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="07-chap_files/figure-html/unnamed-chunk-32-16.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb204"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb204-1"><a href="#cb204-1" aria-hidden="true" tabindex="-1"></a><span class="do">## fviz_pca_ind(pcaMouse, geom = "point", col.ind = xwt$sampleGroup) +</span></span>
<span id="cb204-2"><a href="#cb204-2" aria-hidden="true" tabindex="-1"></a><span class="do">##   ggtitle("") + coord_fixed()</span></span>
<span id="cb204-3"><a href="#cb204-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb204-4"><a href="#cb204-4" aria-hidden="true" tabindex="-1"></a><span class="co"># </span><span class="al">TODO</span><span class="co">: duplicate of the above to avoid overlap; </span></span>
<span id="cb204-5"><a href="#cb204-5" aria-hidden="true" tabindex="-1"></a><span class="co"># can be removed once Quarto resolves this</span></span>
<span id="cb204-6"><a href="#cb204-6" aria-hidden="true" tabindex="-1"></a><span class="fu">fviz_pca_ind</span>(pcaMouse, <span class="at">geom =</span> <span class="st">"point"</span>, <span class="at">col.ind =</span> xwt<span class="sc">$</span>sampleGroup) <span class="sc">+</span></span>
<span id="cb204-7"><a href="#cb204-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">""</span>) <span class="sc">+</span> <span class="fu">coord_fixed</span>()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="07-chap_files/figure-html/unnamed-chunk-32-17.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb205"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb205-1"><a href="#cb205-1" aria-hidden="true" tabindex="-1"></a>u <span class="ot">=</span> <span class="fu">seq</span>(<span class="dv">2</span>, <span class="dv">30</span>, <span class="at">by =</span> <span class="dv">2</span>)</span>
<span id="cb205-2"><a href="#cb205-2" aria-hidden="true" tabindex="-1"></a>v <span class="ot">=</span> <span class="fu">seq</span>(<span class="dv">3</span>, <span class="dv">12</span>, <span class="at">by =</span> <span class="dv">3</span>)</span>
<span id="cb205-3"><a href="#cb205-3" aria-hidden="true" tabindex="-1"></a>X1 <span class="ot">=</span> u <span class="sc">%*%</span> <span class="fu">t</span>(v)</span>
<span id="cb205-4"><a href="#cb205-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb205-5"><a href="#cb205-5" aria-hidden="true" tabindex="-1"></a>Materr <span class="ot">=</span> <span class="fu">matrix</span>(<span class="fu">rnorm</span>(<span class="dv">60</span>,<span class="dv">1</span>),<span class="at">nrow=</span><span class="dv">15</span>,<span class="at">ncol=</span><span class="dv">4</span>)</span>
<span id="cb205-6"><a href="#cb205-6" aria-hidden="true" tabindex="-1"></a>X <span class="ot">=</span> X1<span class="sc">+</span>Materr</span>
<span id="cb205-7"><a href="#cb205-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb205-8"><a href="#cb205-8" aria-hidden="true" tabindex="-1"></a><span class="fu">outer</span>(u, v)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>      [,1] [,2] [,3] [,4]
 [1,]    6   12   18   24
 [2,]   12   24   36   48
 [3,]   18   36   54   72
 [4,]   24   48   72   96
 [5,]   30   60   90  120
 [6,]   36   72  108  144
 [7,]   42   84  126  168
 [8,]   48   96  144  192
 [9,]   54  108  162  216
[10,]   60  120  180  240
[11,]   66  132  198  264
[12,]   72  144  216  288
[13,]   78  156  234  312
[14,]   84  168  252  336
[15,]   90  180  270  360</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb207"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb207-1"><a href="#cb207-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data=</span><span class="fu">data.frame</span>(X), <span class="fu">aes</span>(<span class="at">x=</span>X1, <span class="at">y=</span>X2, <span class="at">col=</span>X3, <span class="at">size=</span>X4)) <span class="sc">+</span> <span class="fu">geom_point</span>()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="07-chap_files/figure-html/unnamed-chunk-32-18.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb208"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb208-1"><a href="#cb208-1" aria-hidden="true" tabindex="-1"></a>n <span class="ot">=</span> <span class="dv">100</span></span>
<span id="cb208-2"><a href="#cb208-2" aria-hidden="true" tabindex="-1"></a>p <span class="ot">=</span> <span class="dv">4</span></span>
<span id="cb208-3"><a href="#cb208-3" aria-hidden="true" tabindex="-1"></a>Y2 <span class="ot">=</span> <span class="fu">outer</span>(<span class="fu">rnorm</span>(n), <span class="fu">rnorm</span>(p)) <span class="sc">+</span> <span class="fu">outer</span>(<span class="fu">rnorm</span>(n), <span class="fu">rnorm</span>(p))</span>
<span id="cb208-4"><a href="#cb208-4" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(Y2)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>           [,1]       [,2]       [,3]       [,4]
[1,] -0.1015264 -1.2018744 -0.1195410 -1.2109954
[2,]  0.6183979  1.4116642  1.4748156 -0.3385532
[3,] -0.6578056 -1.2090886 -1.6057652  0.7420605
[4,] -0.4672680 -1.0598776 -1.1152444  0.2646805
[5,] -0.1821787  0.1713696 -0.5086848  0.8664406
[6,] -0.5857749 -2.8573348 -1.2049193 -1.6640022</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb210"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb210-1"><a href="#cb210-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data=</span><span class="fu">data.frame</span>(Y2), <span class="fu">aes</span>(<span class="at">x=</span>X1, <span class="at">y=</span>X2, <span class="at">col=</span>X3, <span class="at">size=</span>X4)) <span class="sc">+</span> <span class="fu">geom_point</span>()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="07-chap_files/figure-html/unnamed-chunk-32-19.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb211"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb211-1"><a href="#cb211-1" aria-hidden="true" tabindex="-1"></a><span class="fu">svd</span>(Y2)<span class="sc">$</span>d <span class="co"># two non-zero eigenvalues</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 2.577205e+01 1.507554e+01 2.457181e-15 5.708087e-16</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb213"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb213-1"><a href="#cb213-1" aria-hidden="true" tabindex="-1"></a>Y <span class="ot">=</span> Y2 <span class="sc">+</span> <span class="fu">matrix</span>(<span class="fu">rnorm</span>(n<span class="sc">*</span>p, <span class="at">sd=</span><span class="fl">0.01</span>),n,p) <span class="co"># add some noise to Y2</span></span>
<span id="cb213-2"><a href="#cb213-2" aria-hidden="true" tabindex="-1"></a><span class="fu">svd</span>(Y)<span class="sc">$</span>d <span class="co"># four non-zero eigenvalues (but only 2 big ones)</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 25.77159150 15.08360530  0.10578758  0.09180731</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb215"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb215-1"><a href="#cb215-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">"MASS"</span>)</span>
<span id="cb215-2"><a href="#cb215-2" aria-hidden="true" tabindex="-1"></a>mu1 <span class="ot">=</span> <span class="dv">1</span>; mu2 <span class="ot">=</span> <span class="dv">2</span>; s1<span class="ot">=</span><span class="fl">2.5</span>; s2<span class="ot">=</span><span class="fl">0.8</span>; rho<span class="ot">=</span><span class="fl">0.9</span>;</span>
<span id="cb215-3"><a href="#cb215-3" aria-hidden="true" tabindex="-1"></a>sigma <span class="ot">=</span> <span class="fu">matrix</span>(<span class="fu">c</span>(s1<span class="sc">^</span><span class="dv">2</span>, s1<span class="sc">*</span>s2<span class="sc">*</span>rho, s1<span class="sc">*</span>s2<span class="sc">*</span>rho, s2<span class="sc">^</span><span class="dv">2</span>),<span class="dv">2</span>)</span>
<span id="cb215-4"><a href="#cb215-4" aria-hidden="true" tabindex="-1"></a>sim2d <span class="ot">=</span> <span class="fu">data.frame</span>(<span class="fu">mvrnorm</span>(<span class="dv">50</span>, <span class="at">mu =</span> <span class="fu">c</span>(mu1,mu2), <span class="at">Sigma =</span> sigma))</span>
<span id="cb215-5"><a href="#cb215-5" aria-hidden="true" tabindex="-1"></a><span class="fu">svd</span>(<span class="fu">scale</span>(sim2d))<span class="sc">$</span>d</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 9.594338 2.438993</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb217"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb217-1"><a href="#cb217-1" aria-hidden="true" tabindex="-1"></a><span class="fu">svd</span>(<span class="fu">scale</span>(sim2d))<span class="sc">$</span>v[,<span class="dv">1</span>]</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.7071068 0.7071068</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb219"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb219-1"><a href="#cb219-1" aria-hidden="true" tabindex="-1"></a>respc <span class="ot">=</span> <span class="fu">princomp</span>(sim2d)</span>
<span id="cb219-2"><a href="#cb219-2" aria-hidden="true" tabindex="-1"></a>dfpc  <span class="ot">=</span> <span class="fu">data.frame</span>(<span class="at">pc1=</span>respc<span class="sc">$</span>scores[,<span class="dv">1</span>], </span>
<span id="cb219-3"><a href="#cb219-3" aria-hidden="true" tabindex="-1"></a>                   <span class="at">pc2=</span>respc<span class="sc">$</span>scores[,<span class="dv">2</span>])</span>
<span id="cb219-4"><a href="#cb219-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb219-5"><a href="#cb219-5" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="fu">data.frame</span>(sim2d), <span class="fu">aes</span>(<span class="at">x=</span>X1,<span class="at">y=</span>X2)) <span class="sc">+</span> <span class="fu">geom_point</span>()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="07-chap_files/figure-html/unnamed-chunk-32-20.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb220"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb220-1"><a href="#cb220-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(dfpc, <span class="fu">aes</span>(<span class="at">x=</span>pc1, <span class="at">y=</span>pc2)) <span class="sc">+</span> <span class="fu">geom_point</span>() <span class="sc">+</span> <span class="fu">coord_fixed</span>(<span class="dv">2</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="07-chap_files/figure-html/unnamed-chunk-32-21.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb221"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb221-1"><a href="#cb221-1" aria-hidden="true" tabindex="-1"></a><span class="do">## require(vcd)</span></span>
<span id="cb221-2"><a href="#cb221-2" aria-hidden="true" tabindex="-1"></a><span class="do">## uvec0=c(1,5.2,0.5,3.6)</span></span>
<span id="cb221-3"><a href="#cb221-3" aria-hidden="true" tabindex="-1"></a><span class="do">## n=length(uvec0)-1</span></span>
<span id="cb221-4"><a href="#cb221-4" aria-hidden="true" tabindex="-1"></a><span class="do">## vvec0=c(1,1.5,1.8,2.5,1.4)</span></span>
<span id="cb221-5"><a href="#cb221-5" aria-hidden="true" tabindex="-1"></a><span class="do">## p=length(vvec0)-1</span></span>
<span id="cb221-6"><a href="#cb221-6" aria-hidden="true" tabindex="-1"></a><span class="do">## rankone=function(uvec=uvec0,vvec=vvec0,factr=100){</span></span>
<span id="cb221-7"><a href="#cb221-7" aria-hidden="true" tabindex="-1"></a><span class="do">## Xout=uvec%*%t(vvec)*factr</span></span>
<span id="cb221-8"><a href="#cb221-8" aria-hidden="true" tabindex="-1"></a><span class="do">## n=length(uvec)</span></span>
<span id="cb221-9"><a href="#cb221-9" aria-hidden="true" tabindex="-1"></a><span class="do">## p=length(vvec)</span></span>
<span id="cb221-10"><a href="#cb221-10" aria-hidden="true" tabindex="-1"></a><span class="do">## dimnames(Xout)=list(U=c(" ",paste("u",1:(n-1),sep="")),V=c(" ",paste("v",1:(p-1),sep="")))</span></span>
<span id="cb221-11"><a href="#cb221-11" aria-hidden="true" tabindex="-1"></a><span class="do">## return(Xout)</span></span>
<span id="cb221-12"><a href="#cb221-12" aria-hidden="true" tabindex="-1"></a><span class="do">## }</span></span>
<span id="cb221-13"><a href="#cb221-13" aria-hidden="true" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb221-14"><a href="#cb221-14" aria-hidden="true" tabindex="-1"></a><span class="do">## Xmat=rankone()</span></span>
<span id="cb221-15"><a href="#cb221-15" aria-hidden="true" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb221-16"><a href="#cb221-16" aria-hidden="true" tabindex="-1"></a><span class="do">## makelabels=function(Xout=Xmat,step=0){</span></span>
<span id="cb221-17"><a href="#cb221-17" aria-hidden="true" tabindex="-1"></a><span class="do">## tab=as.table(Xout)</span></span>
<span id="cb221-18"><a href="#cb221-18" aria-hidden="true" tabindex="-1"></a><span class="do">## n=nrow(Xout)</span></span>
<span id="cb221-19"><a href="#cb221-19" aria-hidden="true" tabindex="-1"></a><span class="do">## p=ncol(Xout)</span></span>
<span id="cb221-20"><a href="#cb221-20" aria-hidden="true" tabindex="-1"></a><span class="do">## tab[1,1]=NA</span></span>
<span id="cb221-21"><a href="#cb221-21" aria-hidden="true" tabindex="-1"></a><span class="do">## if (step==0){</span></span>
<span id="cb221-22"><a href="#cb221-22" aria-hidden="true" tabindex="-1"></a><span class="do">##   tab[1,]=rep(NA,p)</span></span>
<span id="cb221-23"><a href="#cb221-23" aria-hidden="true" tabindex="-1"></a><span class="do">## tab[,1]=rep(NA,n)</span></span>
<span id="cb221-24"><a href="#cb221-24" aria-hidden="true" tabindex="-1"></a><span class="do">##   }</span></span>
<span id="cb221-25"><a href="#cb221-25" aria-hidden="true" tabindex="-1"></a><span class="do">##   return(tab)</span></span>
<span id="cb221-26"><a href="#cb221-26" aria-hidden="true" tabindex="-1"></a><span class="do">## }</span></span>
<span id="cb221-27"><a href="#cb221-27" aria-hidden="true" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb221-28"><a href="#cb221-28" aria-hidden="true" tabindex="-1"></a><span class="do">## tabf0=makelabels(Xmat,step=0)</span></span>
<span id="cb221-29"><a href="#cb221-29" aria-hidden="true" tabindex="-1"></a><span class="do">## tabf1=makelabels(Xmat,step=1)</span></span>
<span id="cb221-30"><a href="#cb221-30" aria-hidden="true" tabindex="-1"></a><span class="do">## Xsub=Xmat[-1,-1]</span></span>
<span id="cb221-31"><a href="#cb221-31" aria-hidden="true" tabindex="-1"></a><span class="do">## dimnames(Xsub)=NULL</span></span>
<span id="cb221-32"><a href="#cb221-32" aria-hidden="true" tabindex="-1"></a><span class="do">## rowns=paste("$x_{",1:n,".}$",sep="")</span></span>
<span id="cb221-33"><a href="#cb221-33" aria-hidden="true" tabindex="-1"></a><span class="do">## colns=paste("$x_{.",1:p,"}$",sep="")</span></span>
<span id="cb221-34"><a href="#cb221-34" aria-hidden="true" tabindex="-1"></a><span class="do">## dimnames(Xsub)=list(rowns,colns)</span></span>
<span id="cb221-35"><a href="#cb221-35" aria-hidden="true" tabindex="-1"></a><span class="do">## require(xtable)</span></span>
<span id="cb221-36"><a href="#cb221-36" aria-hidden="true" tabindex="-1"></a><span class="do">## xtab=xtable(Xsub,floating=FALSE,digits=0)</span></span>
<span id="cb221-37"><a href="#cb221-37" aria-hidden="true" tabindex="-1"></a><span class="do">## xtab</span></span>
<span id="cb221-38"><a href="#cb221-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb221-39"><a href="#cb221-39" aria-hidden="true" tabindex="-1"></a><span class="do">## np = prod(dim(Xmat))</span></span>
<span id="cb221-40"><a href="#cb221-40" aria-hidden="true" tabindex="-1"></a><span class="do">## rainbow_colors = colorspace::rainbow_hcl(np, c = 50, l = 70, start = 30, end = 360*(np-1)/np)</span></span>
<span id="cb221-41"><a href="#cb221-41" aria-hidden="true" tabindex="-1"></a><span class="do">## mycols = rainbow_colors[1:np]</span></span>
<span id="cb221-42"><a href="#cb221-42" aria-hidden="true" tabindex="-1"></a><span class="do">## mycols[c(1:(n+1), seq(n+2,(n+1)*(p+1),n+1))] = "white"</span></span>
<span id="cb221-43"><a href="#cb221-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb221-44"><a href="#cb221-44" aria-hidden="true" tabindex="-1"></a><span class="do">## Xmat0=Xmat</span></span>
<span id="cb221-45"><a href="#cb221-45" aria-hidden="true" tabindex="-1"></a><span class="do">## #dimnames(Xmat0)=NULL</span></span>
<span id="cb221-46"><a href="#cb221-46" aria-hidden="true" tabindex="-1"></a><span class="do">## mosaic(Xmat,pop=FALSE,  gp = gpar(fill=matrix(mycols,ncol=p+1),fontsize=14))</span></span>
<span id="cb221-47"><a href="#cb221-47" aria-hidden="true" tabindex="-1"></a><span class="do">## #tabf0</span></span>
<span id="cb221-48"><a href="#cb221-48" aria-hidden="true" tabindex="-1"></a><span class="do">## #tabf1</span></span>
<span id="cb221-49"><a href="#cb221-49" aria-hidden="true" tabindex="-1"></a><span class="do">## labeling_cells(text = tabf0,clip=FALSE,gp_labels = gpar(fontsize = 14))(tabf0)</span></span>
<span id="cb221-50"><a href="#cb221-50" aria-hidden="true" tabindex="-1"></a><span class="do">## #labeling_border(labels =FALSE)</span></span>
<span id="cb221-51"><a href="#cb221-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb221-52"><a href="#cb221-52" aria-hidden="true" tabindex="-1"></a><span class="do">## tabf2=tabf1</span></span>
<span id="cb221-53"><a href="#cb221-53" aria-hidden="true" tabindex="-1"></a><span class="do">## tabf2[-1,1]=0.1*tabf1[-1,1]</span></span>
<span id="cb221-54"><a href="#cb221-54" aria-hidden="true" tabindex="-1"></a><span class="do">## tabf2[1,-1]=0.1*tabf1[1,-1]</span></span>
<span id="cb221-55"><a href="#cb221-55" aria-hidden="true" tabindex="-1"></a><span class="do">## mosaic(Xmat,pop=FALSE,  gp = gpar(fill=matrix(mycols,ncol=p+1),fontsize=14))</span></span>
<span id="cb221-56"><a href="#cb221-56" aria-hidden="true" tabindex="-1"></a><span class="do">## labeling_cells(text = tabf2,clip=FALSE,gp_labels = gpar(fontsize = 14))(tabf2)</span></span>
<span id="cb221-57"><a href="#cb221-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb221-58"><a href="#cb221-58" aria-hidden="true" tabindex="-1"></a><span class="do">## tabf3=tabf1</span></span>
<span id="cb221-59"><a href="#cb221-59" aria-hidden="true" tabindex="-1"></a><span class="do">## tabf3[-1,1]=0.05*tabf1[-1,1]</span></span>
<span id="cb221-60"><a href="#cb221-60" aria-hidden="true" tabindex="-1"></a><span class="do">## tabf3[1,-1]=0.2*tabf1[1,-1]</span></span>
<span id="cb221-61"><a href="#cb221-61" aria-hidden="true" tabindex="-1"></a><span class="do">## mosaic(Xmat,pop=FALSE,  gp = gpar(fill=matrix(mycols,ncol=p+1),fontsize=14))</span></span>
<span id="cb221-62"><a href="#cb221-62" aria-hidden="true" tabindex="-1"></a><span class="do">## labeling_cells(text = tabf3,clip=FALSE,gp_labels = gpar(fontsize = 14))(tabf3)</span></span>
<span id="cb221-63"><a href="#cb221-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb221-64"><a href="#cb221-64" aria-hidden="true" tabindex="-1"></a><span class="do">## USV=svd(Xsub)</span></span>
<span id="cb221-65"><a href="#cb221-65" aria-hidden="true" tabindex="-1"></a><span class="do">## tabusv=tabf0</span></span>
<span id="cb221-66"><a href="#cb221-66" aria-hidden="true" tabindex="-1"></a><span class="do">## tabusv[1,]=c(round(USV$d[1],1),round(USV$v[,1],1))</span></span>
<span id="cb221-67"><a href="#cb221-67" aria-hidden="true" tabindex="-1"></a><span class="do">## tabusv[-1,1]=round(USV$u[,1],1)</span></span>
<span id="cb221-68"><a href="#cb221-68" aria-hidden="true" tabindex="-1"></a><span class="do">## #dimnames(tabusv)[[1]][1]="s1"</span></span>
<span id="cb221-69"><a href="#cb221-69" aria-hidden="true" tabindex="-1"></a><span class="do">## mosaic(Xmat,pop=FALSE,  gp = gpar(fill=matrix(mycols,ncol=5),fontsize = 14))</span></span>
<span id="cb221-70"><a href="#cb221-70" aria-hidden="true" tabindex="-1"></a><span class="do">## labeling_cells(text = tabusv,clip=FALSE,gp_labels = gpar(fontsize = 14))(tabusv)</span></span>
<span id="cb221-71"><a href="#cb221-71" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb221-72"><a href="#cb221-72" aria-hidden="true" tabindex="-1"></a><span class="do">## u2=c(5,2,3,4,1.5)</span></span>
<span id="cb221-73"><a href="#cb221-73" aria-hidden="true" tabindex="-1"></a><span class="do">## v2=c(2,7,3,4)</span></span>
<span id="cb221-74"><a href="#cb221-74" aria-hidden="true" tabindex="-1"></a><span class="do">## u3=c(0.5,1,2,2,3)</span></span>
<span id="cb221-75"><a href="#cb221-75" aria-hidden="true" tabindex="-1"></a><span class="do">## v3=c(1,0,4,2)</span></span>
<span id="cb221-76"><a href="#cb221-76" aria-hidden="true" tabindex="-1"></a><span class="do">## Xmat2=rankone(c(1,u2),c(1,v2),1)</span></span>
<span id="cb221-77"><a href="#cb221-77" aria-hidden="true" tabindex="-1"></a><span class="do">## Xmat3=rankone(c(1,u3),c(1,v3),5)</span></span>
<span id="cb221-78"><a href="#cb221-78" aria-hidden="true" tabindex="-1"></a><span class="do">## Xmat4=Xmat2+Xmat3</span></span>
<span id="cb221-79"><a href="#cb221-79" aria-hidden="true" tabindex="-1"></a><span class="do">## tab3f0=makelabels(Xmat4,step=0)</span></span>
<span id="cb221-80"><a href="#cb221-80" aria-hidden="true" tabindex="-1"></a><span class="do">## n=5;p=4;</span></span>
<span id="cb221-81"><a href="#cb221-81" aria-hidden="true" tabindex="-1"></a><span class="do">## mycols[c(1:(n+1),seq(n+2,(n+1)*(p+1),n+1))]="white"</span></span>
<span id="cb221-82"><a href="#cb221-82" aria-hidden="true" tabindex="-1"></a><span class="do">## mosaic(Xmat4,pop=FALSE,  gp = gpar(fill=matrix(mycols,ncol=p+1),fontsize=14))</span></span>
<span id="cb221-83"><a href="#cb221-83" aria-hidden="true" tabindex="-1"></a><span class="do">## labeling_cells(text = tab3f0,clip=FALSE,gp_labels = gpar(fontsize = 14))(tab3f0)</span></span>
<span id="cb221-84"><a href="#cb221-84" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb221-85"><a href="#cb221-85" aria-hidden="true" tabindex="-1"></a><span class="do">## tab3f1=makelabels(Xmat3,step=1)</span></span>
<span id="cb221-86"><a href="#cb221-86" aria-hidden="true" tabindex="-1"></a><span class="do">## mosaic(Xmat3,pop=FALSE,  gp = gpar(fill=matrix(mycols,ncol=p+1),fontsize=14))</span></span>
<span id="cb221-87"><a href="#cb221-87" aria-hidden="true" tabindex="-1"></a><span class="do">## labeling_cells(text = tab3f1,clip=FALSE,gp_labels = gpar(fontsize = 14))(tab3f1)</span></span>
<span id="cb221-88"><a href="#cb221-88" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb221-89"><a href="#cb221-89" aria-hidden="true" tabindex="-1"></a><span class="do">## tab2f1=makelabels(Xmat2,step=1)</span></span>
<span id="cb221-90"><a href="#cb221-90" aria-hidden="true" tabindex="-1"></a><span class="do">## mosaic(Xmat2,pop=FALSE,  gp = gpar(fill=matrix(mycols,ncol=p+1),fontsize=14))</span></span>
<span id="cb221-91"><a href="#cb221-91" aria-hidden="true" tabindex="-1"></a><span class="do">## labeling_cells(text = tab2f1,clip=FALSE,gp_labels = gpar(fontsize = 14))(tab2f1)</span></span>
<span id="cb221-92"><a href="#cb221-92" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb221-93"><a href="#cb221-93" aria-hidden="true" tabindex="-1"></a><span class="do">## Xsub4=Xmat4[-1,-1]</span></span>
<span id="cb221-94"><a href="#cb221-94" aria-hidden="true" tabindex="-1"></a><span class="do">## Xsub3=Xmat3[-1,-1]</span></span>
<span id="cb221-95"><a href="#cb221-95" aria-hidden="true" tabindex="-1"></a><span class="do">## Xsub2=Xmat2[-1,-1]</span></span>
<span id="cb221-96"><a href="#cb221-96" aria-hidden="true" tabindex="-1"></a><span class="do">## svd(Xsub3)</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
      const outerScaffold = trigger.parentElement.cloneNode(true);
      const codeEl = outerScaffold.querySelector('code');
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->




</body></html>